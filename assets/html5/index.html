<!doctype html>
<html>
  <head>
    <script type="text/javascript" charset="utf-8" src="iscroll.js"></script>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body, html {
        background-color: rgba(0, 0, 0, 0);
        width: 100%;
        height: 100%;
      }
      .invisible {
        opacity: 0;
      }
      .visible {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <h1 id="title">Metal Wolf</h1>
    <h1 id="start">start</h1>
    <span id="player_health"></span>
    <script>
      try {
        var bridge = {
          queue: [],
          enqueue: function(function_pointer, string_argument) {
            this.queue.push(function_pointer + "|" + string_argument);
          },
          dequeue: function() {
            dequeued_message = this.queue.shift();
            return dequeued_message;
          },
          register: function(function_name, function_pointer) {
            this[function_name] = function(string_argument) {
              this.enqueue(function_pointer, string_argument);
            };
          },
          finalize: function() {
            console.log('done');
            startButton.className = "visible";
          }
        };
        
        var debug_alert = function() {
          bridge.echoecho("foo");
        };

        var startButton = document.getElementById("start");
        var playerHealthSpan = document.getElementById("player_health");

        startButton.onclick = function(e) {
          try {
            bridge.set_user_interaction_enabled("0");
            bridge.start_game("1");
          } catch(e) {
            alert(e);
          }
        };
        
        var player_health = 100;

        (function tick() {
          try {
            playerHealthSpan.innerHTML = player_health;
            setTimeout(tick, 32); //32ms is 30fps
          } catch(e) {
            alert(e);
          }
        })();
      } catch(e) {
        alert(e);
      }
    </script>
  </body>
</html>
