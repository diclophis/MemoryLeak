<!doctype html>
<html>
  <head>
    <script type="text/javascript" charset="utf-8" src="iscroll.js"></script>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
      * {
        margin: 0;
        padding: 0;
        -webkit-transition-duration: 0.66s;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      div {
        display: -webkit-box;
      }

      body, html {
        width: 100%;
        height: 100%;
      }

      .invisible {
        display: none;
        z-index: -1;
      }

      .visible {
        display: -webkit-box;
        z-index: 1;
      }

      .transparent {
        background-color: rgba(0, 0, 0, 0);
      }

      .translucent {
        background-color: rgba(0, 0, 0, 0.5);
      }

      #overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #inventory {
        width: 100%;
        height: 10%;
        background-color: cyan;
        -webkit-backface-visibility: hidden;
      }

      .visible #inventory {
      }

      #main-menu {
        position: absolute;
        top: 10%;
        left: 0;
        width: 100%;
        height: 90%;
        -webkit-box-orient: vertical;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        -webkit-backface-visibility: hidden;
      }

      #main-menu div {
        width: 75%;
      }

      #shop {
        color: orange;
        background-color: grey;
        position: absolute;
        top: 10%;
        left: 0;
        width: 100%;
        height: 90%;
        -webkit-backface-visibility: hidden;
      }

      #title {
        color: white;
        text-align: center;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        background-color: red;
      }

      #flavor {
        text-align: center;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        background-color: blue;
        color: white;
      }

      .visible #flavor {
        -webkit-transition-delay: 1s;
      }

      #start-button {
        height: 20%;
        color: green;
        text-align: center;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        background-color: yellow;
        -webkit-transition-delay: 2s;
      }

      .visible #start-button {
        -webkit-transform: translate3d(0%, 0, 0);
      }

      .invisible #start-button {
        -webkit-transform: translate3d(500%, 0, 0);
      }

      #shop-button {
        height: 20%;
        color: blue;
        text-align: center;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        background-color: purple;
        -webkit-transition-delay: 2s;
      }

      .visible #shop-button {
        -webkit-transform: translate3d(0%, 0, 0);
      }

      .invisible #shop-button {
        -webkit-transform: translate3d(-500%, 0, 0);
      }

      #hud {
        color: red;
        background-color: green;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5%;
      }

      #player-health-container {
        width: 50%;
        height: 100%;
      }

      #player-health-bar {
        width: 100%;
        background-color: purple;
      }

      #enemy-health-container {
        width: 50%;
        height: 100%;
        background-color: green;
      }

      #enemy-health-bar {
        width: 100%;
        background-color: yellow;
      }

    </style>
  </head>
  <body class="translucent">
    <div id="overlay" class="transparent">
      <div id="hud" class="invisible">
        <div id="player-health-container">
          <div id="player-health-bar">
            <span id="player-health"></span>
          </div>
        </div>
        <div id="enemy-health-container">
          <div id="enemy-health-bar">
            <span id="enemy-health"></span>
          </div>
        </div>
      </div>
      <div id="shop" class="invisible">
        <div id="back-to-main-from-shop-button">
          main
        </div>
      </div>
      <div id="inventory" class="invisible">
        <span id="pennies">
        </span>
        <span id="fuel">
        </span>
      </div>
      <div id="main-menu" class="invisible">
        <div id="title">
          <h1>
            Metal Wolf
          </h1>
        </div>
        <div id="flavor">
          It started with an Eclipse.  The light from the sun was blocked by a massive object of unknown origin.  Strange.  Even more strangely, it was coming closer.  We discovered it to be a ship,  the size of a small planet.  Without warning, without provocation, it began firing on us, reducing our largest cities to ash.  Their technology is hundreds of years ahead of ours.  We are completely outgunned.  The only hope of survival we have, is each other.
        </div>
        <div id="start-button">start</div>
        <div id="shop-button">shop</div>
      </div>
    </div>
    <script>
      try {

        var startButton = document.getElementById("start-button");
        var shopButton = document.getElementById("shop-button");
        var backToMainFromShopButton = document.getElementById("back-to-main-from-shop-button");

        var playerHealthSpan = document.getElementById("player-health");
        var playerHealthBar = document.getElementById("player-health-bar");
        var enemyHealthSpan = document.getElementById("enemy-health");
        var enemyHealthBar = document.getElementById("enemy-health-bar");

        var mainMenu = document.getElementById("main-menu");
        var hud = document.getElementById("hud");
        var shop = document.getElementById("shop");
        var inventory = document.getElementById("inventory");

        var player_health = 100;
        var enemy_health = 3000;

        var bridge = {
          queue: [],
          enqueue: function(function_pointer, string_argument) {
            this.queue.push(function_pointer + "|" + string_argument);
          },
          dequeue: function() {
            dequeued_message = this.queue.shift();
            return dequeued_message;
          },
          register: function(function_name, function_pointer) {
            this[function_name] = function(string_argument) {
              this.enqueue(function_pointer, string_argument);
            };
          },
          finalize: function() {
            show_inventory();
            show_main_menu();
            return true;
          }
        };
        
        var debug_alert = function() {
          bridge.echoecho("foo");
        };

        var present_results = function() {
          document.body.className = "translucent";
          hud.className = "invisible";
          mainMenu.className = "visible";
          bridge.set_user_interaction_enabled("1");
        };

        var hide_body = function() {
          document.body.className = "transparent";
        };

        var show_body = function() {
          document.body.className = "translucent";
        };

        var hide_main_menu = function() {
          mainMenu.className = "invisible";
        };

        var show_main_menu = function() {
          mainMenu.className = "visible";
        };

        var hide_hud = function() {
          hud.className = "invisible";
        };

        var show_hud = function() {
          hud.className = "visible transparent";
        };

        var hide_shop = function() {
          shop.className = "invisible";
        };

        var show_shop = function() {
          shop.className = "visible transparent";
        };

        var hide_inventory = function() {
          inventory.className = "invisible";
        };

        var show_inventory = function() {
          inventory.className = "visible transparent";
        };

        startButton.onclick = function(e) {
          hide_body();
          hide_main_menu();
          hide_inventory();
          show_hud();
          try {
            bridge.set_user_interaction_enabled("0");
            bridge.start_game("1");
          } catch(e) {
            console.log(e);
          }
        };

        shopButton.onclick = function(e) {
          hide_main_menu();
          show_shop();
        };

        backToMainFromShopButton.onclick = function(e) {
          hide_shop();
          show_main_menu();
        };

        (function tick() {
          try {
            var player_health_percent = (player_health / 100.0) * 100.0;
            var enemy_health_percent = (enemy_health / 3000.0) * 100.0;
            playerHealthBar.style.width = player_health_percent + "%";
            enemyHealthBar.style.width = enemy_health_percent + "%";
            playerHealthSpan.innerHTML = player_health;
            enemyHealthSpan.innerHTML = enemy_health;

            setTimeout(tick, 32); //32ms is 30fps
          } catch(e) {
            alert(e);
          }
        })();
      } catch(e) {
        alert(e);
      }
    </script>
  </body>
</html>
