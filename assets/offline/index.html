<!DOCTYPE html>
<html id="home" lang="en">
  <head>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width,maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" /> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
    <!--
    <script type="text/javascript" src="https://raw.github.com/cubiq/iscroll/master/src/iscroll.js">
    -->
    <script type="text/javascript" src="data:;base64,LyohCiAqIGlTY3JvbGwgdjQuMS45IH4gQ29weXJpZ2h0IChjKSAyMDExIE1hdHRlbyBTcGluZWxsaSwgaHR0cDovL2N1YmlxLm9yZwogKiBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZSwgaHR0cDovL2N1YmlxLm9yZy9saWNlbnNlCiAqLwoKKGZ1bmN0aW9uKCl7CnZhciBtID0gTWF0aCwKCXZlbmRvciA9ICgvd2Via2l0L2kpLnRlc3QobmF2aWdhdG9yLmFwcFZlcnNpb24pID8gJ3dlYmtpdCcgOgoJCSgvZmlyZWZveC9pKS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpID8gJ01veicgOgoJCSdvcGVyYScgaW4gd2luZG93ID8gJ08nIDogJycsCgoJLy8gQnJvd3NlciBjYXBhYmlsaXRpZXMKCWhhczNkID0gJ1dlYktpdENTU01hdHJpeCcgaW4gd2luZG93ICYmICdtMTEnIGluIG5ldyBXZWJLaXRDU1NNYXRyaXgoKSwKCWhhc1RvdWNoID0gJ29udG91Y2hzdGFydCcgaW4gd2luZG93LAoJaGFzVHJhbnNmb3JtID0gdmVuZG9yICsgJ1RyYW5zZm9ybScgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLAoJaXNBbmRyb2lkID0gKC9hbmRyb2lkL2dpKS50ZXN0KG5hdmlnYXRvci5hcHBWZXJzaW9uKSwKCWlzSURldmljZSA9ICgvaXBob25lfGlwYWQvZ2kpLnRlc3QobmF2aWdhdG9yLmFwcFZlcnNpb24pLAoJaXNQbGF5Ym9vayA9ICgvcGxheWJvb2svZ2kpLnRlc3QobmF2aWdhdG9yLmFwcFZlcnNpb24pLAoJaGFzVHJhbnNpdGlvbkVuZCA9IGlzSURldmljZSB8fCBpc1BsYXlib29rLAoJbmV4dEZyYW1lID0gKGZ1bmN0aW9uKCkgewoJICAgIHJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lCgkJCXx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUKCQkJfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZQoJCQl8fCB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZQoJCQl8fCB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUKCQkJfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgcmV0dXJuIHNldFRpbWVvdXQoY2FsbGJhY2ssIDEpOyB9Cgl9KSgpLAoJY2FuY2VsRnJhbWUgPSAoZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiB3aW5kb3cuY2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lCgkJCXx8IHdpbmRvdy53ZWJraXRDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUKCQkJfHwgd2luZG93Lm1vekNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZQoJCQl8fCB3aW5kb3cub0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZQoJCQl8fCB3aW5kb3cubXNDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUKCQkJfHwgY2xlYXJUaW1lb3V0Cgl9KSgpLAoKCS8vIEV2ZW50cwoJUkVTSVpFX0VWID0gJ29ub3JpZW50YXRpb25jaGFuZ2UnIGluIHdpbmRvdyA/ICdvcmllbnRhdGlvbmNoYW5nZScgOiAncmVzaXplJywKCVNUQVJUX0VWID0gaGFzVG91Y2ggPyAndG91Y2hzdGFydCcgOiAnbW91c2Vkb3duJywKCU1PVkVfRVYgPSBoYXNUb3VjaCA/ICd0b3VjaG1vdmUnIDogJ21vdXNlbW92ZScsCglFTkRfRVYgPSBoYXNUb3VjaCA/ICd0b3VjaGVuZCcgOiAnbW91c2V1cCcsCglDQU5DRUxfRVYgPSBoYXNUb3VjaCA/ICd0b3VjaGNhbmNlbCcgOiAnbW91c2V1cCcsCglXSEVFTF9FViA9IHZlbmRvciA9PSAnTW96JyA/ICdET01Nb3VzZVNjcm9sbCcgOiAnbW91c2V3aGVlbCcsCgoJLy8gSGVscGVycwoJdHJuT3BlbiA9ICd0cmFuc2xhdGUnICsgKGhhczNkID8gJzNkKCcgOiAnKCcpLAoJdHJuQ2xvc2UgPSBoYXMzZCA/ICcsMCknIDogJyknLAoKCS8vIENvbnN0cnVjdG9yCglpU2Nyb2xsID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlkb2MgPSBkb2N1bWVudCwKCQkJaTsKCgkJdGhhdC53cmFwcGVyID0gdHlwZW9mIGVsID09ICdvYmplY3QnID8gZWwgOiBkb2MuZ2V0RWxlbWVudEJ5SWQoZWwpOwoJCXRoYXQud3JhcHBlci5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwoJCXRoYXQuc2Nyb2xsZXIgPSB0aGF0LndyYXBwZXIuY2hpbGRyZW5bMF07CgoJCS8vIERlZmF1bHQgb3B0aW9ucwoJCXRoYXQub3B0aW9ucyA9IHsKCQkJaFNjcm9sbDogdHJ1ZSwKCQkJdlNjcm9sbDogdHJ1ZSwKCQkJYm91bmNlOiB0cnVlLAoJCQlib3VuY2VMb2NrOiBmYWxzZSwKCQkJbW9tZW50dW06IHRydWUsCgkJCWxvY2tEaXJlY3Rpb246IHRydWUsCgkJCXVzZVRyYW5zZm9ybTogdHJ1ZSwKCQkJdXNlVHJhbnNpdGlvbjogZmFsc2UsCgkJCXRvcE9mZnNldDogMCwKCQkJY2hlY2tET01DaGFuZ2VzOiBmYWxzZSwJCS8vIEV4cGVyaW1lbnRhbAoKCQkJLy8gU2Nyb2xsYmFyCgkJCWhTY3JvbGxiYXI6IHRydWUsCgkJCXZTY3JvbGxiYXI6IHRydWUsCgkJCWZpeGVkU2Nyb2xsYmFyOiBpc0FuZHJvaWQsCgkJCWhpZGVTY3JvbGxiYXI6IGlzSURldmljZSwKCQkJZmFkZVNjcm9sbGJhcjogaXNJRGV2aWNlICYmIGhhczNkLAoJCQlzY3JvbGxiYXJDbGFzczogJycsCgoJCQkvLyBab29tCgkJCXpvb206IGZhbHNlLAoJCQl6b29tTWluOiAxLAoJCQl6b29tTWF4OiA0LAoJCQlkb3VibGVUYXBab29tOiAyLAoJCQl3aGVlbEFjdGlvbjogJ3Njcm9sbCcsCgoJCQkvLyBTbmFwCgkJCXNuYXA6IGZhbHNlLAoJCQlzbmFwVGhyZXNob2xkOiAxLAoKCQkJLy8gRXZlbnRzCgkJCW9uUmVmcmVzaDogbnVsbCwKCQkJb25CZWZvcmVTY3JvbGxTdGFydDogZnVuY3Rpb24gKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9LAoJCQlvblNjcm9sbFN0YXJ0OiBudWxsLAoJCQlvbkJlZm9yZVNjcm9sbE1vdmU6IG51bGwsCgkJCW9uU2Nyb2xsTW92ZTogbnVsbCwKCQkJb25CZWZvcmVTY3JvbGxFbmQ6IG51bGwsCgkJCW9uU2Nyb2xsRW5kOiBudWxsLAoJCQlvblRvdWNoRW5kOiBudWxsLAoJCQlvbkRlc3Ryb3k6IG51bGwsCgkJCW9uWm9vbVN0YXJ0OiBudWxsLAoJCQlvblpvb206IG51bGwsCgkJCW9uWm9vbUVuZDogbnVsbAoJCX07CgoJCS8vIFVzZXIgZGVmaW5lZCBvcHRpb25zCgkJZm9yIChpIGluIG9wdGlvbnMpIHRoYXQub3B0aW9uc1tpXSA9IG9wdGlvbnNbaV07CgoJCS8vIE5vcm1hbGl6ZSBvcHRpb25zCgkJdGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSA9IGhhc1RyYW5zZm9ybSA/IHRoYXQub3B0aW9ucy51c2VUcmFuc2Zvcm0gOiBmYWxzZTsKCQl0aGF0Lm9wdGlvbnMuaFNjcm9sbGJhciA9IHRoYXQub3B0aW9ucy5oU2Nyb2xsICYmIHRoYXQub3B0aW9ucy5oU2Nyb2xsYmFyOwoJCXRoYXQub3B0aW9ucy52U2Nyb2xsYmFyID0gdGhhdC5vcHRpb25zLnZTY3JvbGwgJiYgdGhhdC5vcHRpb25zLnZTY3JvbGxiYXI7CgkJdGhhdC5vcHRpb25zLnpvb20gPSB0aGF0Lm9wdGlvbnMudXNlVHJhbnNmb3JtICYmIHRoYXQub3B0aW9ucy56b29tOwoJCXRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uID0gaGFzVHJhbnNpdGlvbkVuZCAmJiB0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbjsKCQkKCQkvLyBTZXQgc29tZSBkZWZhdWx0IHN0eWxlcwoJCXRoYXQuc2Nyb2xsZXIuc3R5bGVbdmVuZG9yICsgJ1RyYW5zaXRpb25Qcm9wZXJ0eSddID0gdGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSA/ICctJyArIHZlbmRvci50b0xvd2VyQ2FzZSgpICsgJy10cmFuc2Zvcm0nIDogJ3RvcCBsZWZ0JzsKCQl0aGF0LnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2l0aW9uRHVyYXRpb24nXSA9ICcwJzsKCQl0aGF0LnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2Zvcm1PcmlnaW4nXSA9ICcwIDAnOwoJCWlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbikgdGhhdC5zY3JvbGxlci5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uJ10gPSAnY3ViaWMtYmV6aWVyKDAuMzMsMC42NiwwLjY2LDEpJzsKCQkKCQlpZiAodGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSkgdGhhdC5zY3JvbGxlci5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNmb3JtJ10gPSB0cm5PcGVuICsgJzAsMCcgKyB0cm5DbG9zZTsKCQllbHNlIHRoYXQuc2Nyb2xsZXIuc3R5bGUuY3NzVGV4dCArPSAnO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MCc7CgoJCWlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbikgdGhhdC5vcHRpb25zLmZpeGVkU2Nyb2xsYmFyID0gdHJ1ZTsKCgkJdGhhdC5yZWZyZXNoKCk7CgoJCXRoYXQuX2JpbmQoUkVTSVpFX0VWLCB3aW5kb3cpOwoJCXRoYXQuX2JpbmQoU1RBUlRfRVYpOwoJCWlmICghaGFzVG91Y2gpIHsKCQkJdGhhdC5fYmluZCgnbW91c2VvdXQnLCB0aGF0LndyYXBwZXIpOwoJCQl0aGF0Ll9iaW5kKFdIRUVMX0VWKTsKCQl9CgoJCWlmICh0aGF0Lm9wdGlvbnMuY2hlY2tET01DaGFuZ2VzKSB0aGF0LmNoZWNrRE9NVGltZSA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJdGhhdC5fY2hlY2tET01DaGFuZ2VzKCk7CgkJfSwgNTAwKTsKCX07CgovLyBQcm90b3R5cGUKaVNjcm9sbC5wcm90b3R5cGUgPSB7CgllbmFibGVkOiB0cnVlLAoJeDogMCwKCXk6IDAsCglzdGVwczogW10sCglzY2FsZTogMSwKCWN1cnJQYWdlWDogMCwgY3VyclBhZ2VZOiAwLAoJcGFnZXNYOiBbXSwgcGFnZXNZOiBbXSwKCWFuaVRpbWU6IG51bGwsCgl3aGVlbFpvb21Db3VudDogMCwKCQoJaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCXN3aXRjaChlLnR5cGUpIHsKCQkJY2FzZSBTVEFSVF9FVjoKCQkJCWlmICghaGFzVG91Y2ggJiYgZS5idXR0b24gIT09IDApIHJldHVybjsKCQkJCXRoYXQuX3N0YXJ0KGUpOwoJCQkJYnJlYWs7CgkJCWNhc2UgTU9WRV9FVjogdGhhdC5fbW92ZShlKTsgYnJlYWs7CgkJCWNhc2UgRU5EX0VWOgoJCQljYXNlIENBTkNFTF9FVjogdGhhdC5fZW5kKGUpOyBicmVhazsKCQkJY2FzZSBSRVNJWkVfRVY6IHRoYXQuX3Jlc2l6ZSgpOyBicmVhazsKCQkJY2FzZSBXSEVFTF9FVjogdGhhdC5fd2hlZWwoZSk7IGJyZWFrOwoJCQljYXNlICdtb3VzZW91dCc6IHRoYXQuX21vdXNlb3V0KGUpOyBicmVhazsKCQkJY2FzZSAnd2Via2l0VHJhbnNpdGlvbkVuZCc6IHRoYXQuX3RyYW5zaXRpb25FbmQoZSk7IGJyZWFrOwoJCX0KCX0sCgkKCV9jaGVja0RPTUNoYW5nZXM6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5tb3ZlZCB8fCB0aGlzLnpvb21lZCB8fCB0aGlzLmFuaW1hdGluZyB8fAoJCQkodGhpcy5zY3JvbGxlclcgPT0gdGhpcy5zY3JvbGxlci5vZmZzZXRXaWR0aCAqIHRoaXMuc2NhbGUgJiYgdGhpcy5zY3JvbGxlckggPT0gdGhpcy5zY3JvbGxlci5vZmZzZXRIZWlnaHQgKiB0aGlzLnNjYWxlKSkgcmV0dXJuOwoKCQl0aGlzLnJlZnJlc2goKTsKCX0sCgkKCV9zY3JvbGxiYXI6IGZ1bmN0aW9uIChkaXIpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCWRvYyA9IGRvY3VtZW50LAoJCQliYXI7CgoJCWlmICghdGhhdFtkaXIgKyAnU2Nyb2xsYmFyJ10pIHsKCQkJaWYgKHRoYXRbZGlyICsgJ1Njcm9sbGJhcldyYXBwZXInXSkgewoJCQkJaWYgKGhhc1RyYW5zZm9ybSkgdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbdmVuZG9yICsgJ1RyYW5zZm9ybSddID0gJyc7CgkJCQl0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10pOwoJCQkJdGhhdFtkaXIgKyAnU2Nyb2xsYmFyV3JhcHBlciddID0gbnVsbDsKCQkJCXRoYXRbZGlyICsgJ1Njcm9sbGJhckluZGljYXRvciddID0gbnVsbDsKCQkJfQoKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCF0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10pIHsKCQkJLy8gQ3JlYXRlIHRoZSBzY3JvbGxiYXIgd3JhcHBlcgoJCQliYXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgoJCQlpZiAodGhhdC5vcHRpb25zLnNjcm9sbGJhckNsYXNzKSBiYXIuY2xhc3NOYW1lID0gdGhhdC5vcHRpb25zLnNjcm9sbGJhckNsYXNzICsgZGlyLnRvVXBwZXJDYXNlKCk7CgkJCWVsc2UgYmFyLnN0eWxlLmNzc1RleHQgPSAncG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDoxMDA7JyArIChkaXIgPT0gJ2gnID8gJ2hlaWdodDo3cHg7Ym90dG9tOjFweDtsZWZ0OjJweDtyaWdodDonICsgKHRoYXQudlNjcm9sbGJhciA/ICc3JyA6ICcyJykgKyAncHgnIDogJ3dpZHRoOjdweDtib3R0b206JyArICh0aGF0LmhTY3JvbGxiYXIgPyAnNycgOiAnMicpICsgJ3B4O3RvcDoycHg7cmlnaHQ6MXB4Jyk7CgoJCQliYXIuc3R5bGUuY3NzVGV4dCArPSAnO3BvaW50ZXItZXZlbnRzOm5vbmU7LScgKyB2ZW5kb3IgKyAnLXRyYW5zaXRpb24tcHJvcGVydHk6b3BhY2l0eTstJyArIHZlbmRvciArICctdHJhbnNpdGlvbi1kdXJhdGlvbjonICsgKHRoYXQub3B0aW9ucy5mYWRlU2Nyb2xsYmFyID8gJzM1MG1zJyA6ICcwJykgKyAnO292ZXJmbG93OmhpZGRlbjtvcGFjaXR5OicgKyAodGhhdC5vcHRpb25zLmhpZGVTY3JvbGxiYXIgPyAnMCcgOiAnMScpOwoKCQkJdGhhdC53cmFwcGVyLmFwcGVuZENoaWxkKGJhcik7CgkJCXRoYXRbZGlyICsgJ1Njcm9sbGJhcldyYXBwZXInXSA9IGJhcjsKCgkJCS8vIENyZWF0ZSB0aGUgc2Nyb2xsYmFyIGluZGljYXRvcgoJCQliYXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCWlmICghdGhhdC5vcHRpb25zLnNjcm9sbGJhckNsYXNzKSB7CgkJCQliYXIuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjphYnNvbHV0ZTt6LWluZGV4OjEwMDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC41KTtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC45KTstJyArIHZlbmRvciArICctYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94Oy0nICsgdmVuZG9yICsgJy1ib3gtc2l6aW5nOmJvcmRlci1ib3g7JyArIChkaXIgPT0gJ2gnID8gJ2hlaWdodDoxMDAlJyA6ICd3aWR0aDoxMDAlJykgKyAnOy0nICsgdmVuZG9yICsgJy1ib3JkZXItcmFkaXVzOjNweDtib3JkZXItcmFkaXVzOjNweCc7CgkJCX0KCQkJYmFyLnN0eWxlLmNzc1RleHQgKz0gJztwb2ludGVyLWV2ZW50czpub25lOy0nICsgdmVuZG9yICsgJy10cmFuc2l0aW9uLXByb3BlcnR5Oi0nICsgdmVuZG9yICsgJy10cmFuc2Zvcm07LScgKyB2ZW5kb3IgKyAnLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOmN1YmljLWJlemllcigwLjMzLDAuNjYsMC42NiwxKTstJyArIHZlbmRvciArICctdHJhbnNpdGlvbi1kdXJhdGlvbjowOy0nICsgdmVuZG9yICsgJy10cmFuc2Zvcm06JyArIHRybk9wZW4gKyAnMCwwJyArIHRybkNsb3NlOwoJCQlpZiAodGhhdC5vcHRpb25zLnVzZVRyYW5zaXRpb24pIGJhci5zdHlsZS5jc3NUZXh0ICs9ICc7LScgKyB2ZW5kb3IgKyAnLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOmN1YmljLWJlemllcigwLjMzLDAuNjYsMC42NiwxKSc7CgoJCQl0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10uYXBwZW5kQ2hpbGQoYmFyKTsKCQkJdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10gPSBiYXI7CgkJfQoKCQlpZiAoZGlyID09ICdoJykgewoJCQl0aGF0LmhTY3JvbGxiYXJTaXplID0gdGhhdC5oU2Nyb2xsYmFyV3JhcHBlci5jbGllbnRXaWR0aDsKCQkJdGhhdC5oU2Nyb2xsYmFySW5kaWNhdG9yU2l6ZSA9IG0ubWF4KG0ucm91bmQodGhhdC5oU2Nyb2xsYmFyU2l6ZSAqIHRoYXQuaFNjcm9sbGJhclNpemUgLyB0aGF0LnNjcm9sbGVyVyksIDgpOwoJCQl0aGF0LmhTY3JvbGxiYXJJbmRpY2F0b3Iuc3R5bGUud2lkdGggPSB0aGF0LmhTY3JvbGxiYXJJbmRpY2F0b3JTaXplICsgJ3B4JzsKCQkJdGhhdC5oU2Nyb2xsYmFyTWF4U2Nyb2xsID0gdGhhdC5oU2Nyb2xsYmFyU2l6ZSAtIHRoYXQuaFNjcm9sbGJhckluZGljYXRvclNpemU7CgkJCXRoYXQuaFNjcm9sbGJhclByb3AgPSB0aGF0LmhTY3JvbGxiYXJNYXhTY3JvbGwgLyB0aGF0Lm1heFNjcm9sbFg7CgkJfSBlbHNlIHsKCQkJdGhhdC52U2Nyb2xsYmFyU2l6ZSA9IHRoYXQudlNjcm9sbGJhcldyYXBwZXIuY2xpZW50SGVpZ2h0OwoJCQl0aGF0LnZTY3JvbGxiYXJJbmRpY2F0b3JTaXplID0gbS5tYXgobS5yb3VuZCh0aGF0LnZTY3JvbGxiYXJTaXplICogdGhhdC52U2Nyb2xsYmFyU2l6ZSAvIHRoYXQuc2Nyb2xsZXJIKSwgOCk7CgkJCXRoYXQudlNjcm9sbGJhckluZGljYXRvci5zdHlsZS5oZWlnaHQgPSB0aGF0LnZTY3JvbGxiYXJJbmRpY2F0b3JTaXplICsgJ3B4JzsKCQkJdGhhdC52U2Nyb2xsYmFyTWF4U2Nyb2xsID0gdGhhdC52U2Nyb2xsYmFyU2l6ZSAtIHRoYXQudlNjcm9sbGJhckluZGljYXRvclNpemU7CgkJCXRoYXQudlNjcm9sbGJhclByb3AgPSB0aGF0LnZTY3JvbGxiYXJNYXhTY3JvbGwgLyB0aGF0Lm1heFNjcm9sbFk7CgkJfQoKCQkvLyBSZXNldCBwb3NpdGlvbgoJCXRoYXQuX3Njcm9sbGJhclBvcyhkaXIsIHRydWUpOwoJfSwKCQoJX3Jlc2l6ZTogZnVuY3Rpb24gKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgdGhhdC5yZWZyZXNoKCk7IH0sIGlzQW5kcm9pZCA/IDIwMCA6IDApOwoJfSwKCQoJX3BvczogZnVuY3Rpb24gKHgsIHkpIHsKCQl4ID0gdGhpcy5oU2Nyb2xsID8geCA6IDA7CgkJeSA9IHRoaXMudlNjcm9sbCA/IHkgOiAwOwoKCQlpZiAodGhpcy5vcHRpb25zLnVzZVRyYW5zZm9ybSkgewoJCQl0aGlzLnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2Zvcm0nXSA9IHRybk9wZW4gKyB4ICsgJ3B4LCcgKyB5ICsgJ3B4JyArIHRybkNsb3NlICsgJyBzY2FsZSgnICsgdGhpcy5zY2FsZSArICcpJzsKCQl9IGVsc2UgewoJCQl4ID0gbS5yb3VuZCh4KTsKCQkJeSA9IG0ucm91bmQoeSk7CgkJCXRoaXMuc2Nyb2xsZXIuc3R5bGUubGVmdCA9IHggKyAncHgnOwoJCQl0aGlzLnNjcm9sbGVyLnN0eWxlLnRvcCA9IHkgKyAncHgnOwoJCX0KCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoKCQl0aGlzLl9zY3JvbGxiYXJQb3MoJ2gnKTsKCQl0aGlzLl9zY3JvbGxiYXJQb3MoJ3YnKTsKCX0sCgoJX3Njcm9sbGJhclBvczogZnVuY3Rpb24gKGRpciwgaGlkZGVuKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlwb3MgPSBkaXIgPT0gJ2gnID8gdGhhdC54IDogdGhhdC55LAoJCQlzaXplOwoKCQlpZiAoIXRoYXRbZGlyICsgJ1Njcm9sbGJhciddKSByZXR1cm47CgoJCXBvcyA9IHRoYXRbZGlyICsgJ1Njcm9sbGJhclByb3AnXSAqIHBvczsKCgkJaWYgKHBvcyA8IDApIHsKCQkJaWYgKCF0aGF0Lm9wdGlvbnMuZml4ZWRTY3JvbGxiYXIpIHsKCQkJCXNpemUgPSB0aGF0W2RpciArICdTY3JvbGxiYXJJbmRpY2F0b3JTaXplJ10gKyBtLnJvdW5kKHBvcyAqIDMpOwoJCQkJaWYgKHNpemUgPCA4KSBzaXplID0gODsKCQkJCXRoYXRbZGlyICsgJ1Njcm9sbGJhckluZGljYXRvciddLnN0eWxlW2RpciA9PSAnaCcgPyAnd2lkdGgnIDogJ2hlaWdodCddID0gc2l6ZSArICdweCc7CgkJCX0KCQkJcG9zID0gMDsKCQl9IGVsc2UgaWYgKHBvcyA+IHRoYXRbZGlyICsgJ1Njcm9sbGJhck1heFNjcm9sbCddKSB7CgkJCWlmICghdGhhdC5vcHRpb25zLmZpeGVkU2Nyb2xsYmFyKSB7CgkJCQlzaXplID0gdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yU2l6ZSddIC0gbS5yb3VuZCgocG9zIC0gdGhhdFtkaXIgKyAnU2Nyb2xsYmFyTWF4U2Nyb2xsJ10pICogMyk7CgkJCQlpZiAoc2l6ZSA8IDgpIHNpemUgPSA4OwoJCQkJdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbZGlyID09ICdoJyA/ICd3aWR0aCcgOiAnaGVpZ2h0J10gPSBzaXplICsgJ3B4JzsKCQkJCXBvcyA9IHRoYXRbZGlyICsgJ1Njcm9sbGJhck1heFNjcm9sbCddICsgKHRoYXRbZGlyICsgJ1Njcm9sbGJhckluZGljYXRvclNpemUnXSAtIHNpemUpOwoJCQl9IGVsc2UgewoJCQkJcG9zID0gdGhhdFtkaXIgKyAnU2Nyb2xsYmFyTWF4U2Nyb2xsJ107CgkJCX0KCQl9CgoJCXRoYXRbZGlyICsgJ1Njcm9sbGJhcldyYXBwZXInXS5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNpdGlvbkRlbGF5J10gPSAnMCc7CgkJdGhhdFtkaXIgKyAnU2Nyb2xsYmFyV3JhcHBlciddLnN0eWxlLm9wYWNpdHkgPSBoaWRkZW4gJiYgdGhhdC5vcHRpb25zLmhpZGVTY3JvbGxiYXIgPyAnMCcgOiAnMSc7CgkJdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbdmVuZG9yICsgJ1RyYW5zZm9ybSddID0gdHJuT3BlbiArIChkaXIgPT0gJ2gnID8gcG9zICsgJ3B4LDAnIDogJzAsJyArIHBvcyArICdweCcpICsgdHJuQ2xvc2U7Cgl9LAoJCglfc3RhcnQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlwb2ludCA9IGhhc1RvdWNoID8gZS50b3VjaGVzWzBdIDogZSwKCQkJbWF0cml4LCB4LCB5LAoJCQljMSwgYzI7CgoJCWlmICghdGhhdC5lbmFibGVkKSByZXR1cm47CgoJCWlmICh0aGF0Lm9wdGlvbnMub25CZWZvcmVTY3JvbGxTdGFydCkgdGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsU3RhcnQuY2FsbCh0aGF0LCBlKTsKCgkJaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uIHx8IHRoYXQub3B0aW9ucy56b29tKSB0aGF0Ll90cmFuc2l0aW9uVGltZSgwKTsKCgkJdGhhdC5tb3ZlZCA9IGZhbHNlOwoJCXRoYXQuYW5pbWF0aW5nID0gZmFsc2U7CgkJdGhhdC56b29tZWQgPSBmYWxzZTsKCQl0aGF0LmRpc3RYID0gMDsKCQl0aGF0LmRpc3RZID0gMDsKCQl0aGF0LmFic0Rpc3RYID0gMDsKCQl0aGF0LmFic0Rpc3RZID0gMDsKCQl0aGF0LmRpclggPSAwOwoJCXRoYXQuZGlyWSA9IDA7CgoJCS8vIEdlc3R1cmUgc3RhcnQKCQlpZiAodGhhdC5vcHRpb25zLnpvb20gJiYgaGFzVG91Y2ggJiYgZS50b3VjaGVzLmxlbmd0aCA+IDEpIHsKCQkJYzEgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVgtZS50b3VjaGVzWzFdLnBhZ2VYKTsKCQkJYzIgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVktZS50b3VjaGVzWzFdLnBhZ2VZKTsKCQkJdGhhdC50b3VjaGVzRGlzdFN0YXJ0ID0gbS5zcXJ0KGMxICogYzEgKyBjMiAqIGMyKTsKCgkJCXRoYXQub3JpZ2luWCA9IG0uYWJzKGUudG91Y2hlc1swXS5wYWdlWCArIGUudG91Y2hlc1sxXS5wYWdlWCAtIHRoYXQud3JhcHBlck9mZnNldExlZnQgKiAyKSAvIDIgLSB0aGF0Lng7CgkJCXRoYXQub3JpZ2luWSA9IG0uYWJzKGUudG91Y2hlc1swXS5wYWdlWSArIGUudG91Y2hlc1sxXS5wYWdlWSAtIHRoYXQud3JhcHBlck9mZnNldFRvcCAqIDIpIC8gMiAtIHRoYXQueTsKCgkJCWlmICh0aGF0Lm9wdGlvbnMub25ab29tU3RhcnQpIHRoYXQub3B0aW9ucy5vblpvb21TdGFydC5jYWxsKHRoYXQsIGUpOwoJCX0KCgkJaWYgKHRoYXQub3B0aW9ucy5tb21lbnR1bSkgewoJCQlpZiAodGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSkgewoJCQkJLy8gVmVyeSBsYW1lIGdlbmVyYWwgcHVycG9zZSBhbHRlcm5hdGl2ZSB0byBDU1NNYXRyaXgKCQkJCW1hdHJpeCA9IGdldENvbXB1dGVkU3R5bGUodGhhdC5zY3JvbGxlciwgbnVsbClbdmVuZG9yICsgJ1RyYW5zZm9ybSddLnJlcGxhY2UoL1teMC05LS4sXS9nLCAnJykuc3BsaXQoJywnKTsKCQkJCXggPSBtYXRyaXhbNF0gKiAxOwoJCQkJeSA9IG1hdHJpeFs1XSAqIDE7CgkJCX0gZWxzZSB7CgkJCQl4ID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGF0LnNjcm9sbGVyLCBudWxsKS5sZWZ0LnJlcGxhY2UoL1teMC05LV0vZywgJycpICogMTsKCQkJCXkgPSBnZXRDb21wdXRlZFN0eWxlKHRoYXQuc2Nyb2xsZXIsIG51bGwpLnRvcC5yZXBsYWNlKC9bXjAtOS1dL2csICcnKSAqIDE7CgkJCX0KCQkJCgkJCWlmICh4ICE9IHRoYXQueCB8fCB5ICE9IHRoYXQueSkgewoJCQkJaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uKSB0aGF0Ll91bmJpbmQoJ3dlYmtpdFRyYW5zaXRpb25FbmQnKTsKCQkJCWVsc2UgY2FuY2VsRnJhbWUodGhhdC5hbmlUaW1lKTsKCQkJCXRoYXQuc3RlcHMgPSBbXTsKCQkJCXRoYXQuX3Bvcyh4LCB5KTsKCQkJfQoJCX0KCgkJdGhhdC5hYnNTdGFydFggPSB0aGF0Lng7CS8vIE5lZWRlZCBieSBzbmFwIHRocmVzaG9sZAoJCXRoYXQuYWJzU3RhcnRZID0gdGhhdC55OwoKCQl0aGF0LnN0YXJ0WCA9IHRoYXQueDsKCQl0aGF0LnN0YXJ0WSA9IHRoYXQueTsKCQl0aGF0LnBvaW50WCA9IHBvaW50LnBhZ2VYOwoJCXRoYXQucG9pbnRZID0gcG9pbnQucGFnZVk7CgoJCXRoYXQuc3RhcnRUaW1lID0gZS50aW1lU3RhbXAgfHwgKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCgkJaWYgKHRoYXQub3B0aW9ucy5vblNjcm9sbFN0YXJ0KSB0aGF0Lm9wdGlvbnMub25TY3JvbGxTdGFydC5jYWxsKHRoYXQsIGUpOwoKCQl0aGF0Ll9iaW5kKE1PVkVfRVYpOwoJCXRoYXQuX2JpbmQoRU5EX0VWKTsKCQl0aGF0Ll9iaW5kKENBTkNFTF9FVik7Cgl9LAoJCglfbW92ZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXBvaW50ID0gaGFzVG91Y2ggPyBlLnRvdWNoZXNbMF0gOiBlLAoJCQlkZWx0YVggPSBwb2ludC5wYWdlWCAtIHRoYXQucG9pbnRYLAoJCQlkZWx0YVkgPSBwb2ludC5wYWdlWSAtIHRoYXQucG9pbnRZLAoJCQluZXdYID0gdGhhdC54ICsgZGVsdGFYLAoJCQluZXdZID0gdGhhdC55ICsgZGVsdGFZLAoJCQljMSwgYzIsIHNjYWxlLAoJCQl0aW1lc3RhbXAgPSBlLnRpbWVTdGFtcCB8fCAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwoKCQlpZiAodGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsTW92ZSkgdGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsTW92ZS5jYWxsKHRoYXQsIGUpOwoKCQkvLyBab29tCgkJaWYgKHRoYXQub3B0aW9ucy56b29tICYmIGhhc1RvdWNoICYmIGUudG91Y2hlcy5sZW5ndGggPiAxKSB7CgkJCWMxID0gbS5hYnMoZS50b3VjaGVzWzBdLnBhZ2VYIC0gZS50b3VjaGVzWzFdLnBhZ2VYKTsKCQkJYzIgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVkgLSBlLnRvdWNoZXNbMV0ucGFnZVkpOwoJCQl0aGF0LnRvdWNoZXNEaXN0ID0gbS5zcXJ0KGMxKmMxK2MyKmMyKTsKCgkJCXRoYXQuem9vbWVkID0gdHJ1ZTsKCgkJCXNjYWxlID0gMSAvIHRoYXQudG91Y2hlc0Rpc3RTdGFydCAqIHRoYXQudG91Y2hlc0Rpc3QgKiB0aGlzLnNjYWxlOwoKCQkJaWYgKHNjYWxlIDwgdGhhdC5vcHRpb25zLnpvb21NaW4pIHNjYWxlID0gMC41ICogdGhhdC5vcHRpb25zLnpvb21NaW4gKiBNYXRoLnBvdygyLjAsIHNjYWxlIC8gdGhhdC5vcHRpb25zLnpvb21NaW4pOwoJCQllbHNlIGlmIChzY2FsZSA+IHRoYXQub3B0aW9ucy56b29tTWF4KSBzY2FsZSA9IDIuMCAqIHRoYXQub3B0aW9ucy56b29tTWF4ICogTWF0aC5wb3coMC41LCB0aGF0Lm9wdGlvbnMuem9vbU1heCAvIHNjYWxlKTsKCgkJCXRoYXQubGFzdFNjYWxlID0gc2NhbGUgLyB0aGlzLnNjYWxlOwoKCQkJbmV3WCA9IHRoaXMub3JpZ2luWCAtIHRoaXMub3JpZ2luWCAqIHRoYXQubGFzdFNjYWxlICsgdGhpcy54LAoJCQluZXdZID0gdGhpcy5vcmlnaW5ZIC0gdGhpcy5vcmlnaW5ZICogdGhhdC5sYXN0U2NhbGUgKyB0aGlzLnk7CgoJCQl0aGlzLnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2Zvcm0nXSA9IHRybk9wZW4gKyBuZXdYICsgJ3B4LCcgKyBuZXdZICsgJ3B4JyArIHRybkNsb3NlICsgJyBzY2FsZSgnICsgc2NhbGUgKyAnKSc7CgoJCQlpZiAodGhhdC5vcHRpb25zLm9uWm9vbSkgdGhhdC5vcHRpb25zLm9uWm9vbS5jYWxsKHRoYXQsIGUpOwoJCQlyZXR1cm47CgkJfQoKCQl0aGF0LnBvaW50WCA9IHBvaW50LnBhZ2VYOwoJCXRoYXQucG9pbnRZID0gcG9pbnQucGFnZVk7CgoJCS8vIFNsb3cgZG93biBpZiBvdXRzaWRlIG9mIHRoZSBib3VuZGFyaWVzCgkJaWYgKG5ld1ggPiAwIHx8IG5ld1ggPCB0aGF0Lm1heFNjcm9sbFgpIHsKCQkJbmV3WCA9IHRoYXQub3B0aW9ucy5ib3VuY2UgPyB0aGF0LnggKyAoZGVsdGFYIC8gMikgOiBuZXdYID49IDAgfHwgdGhhdC5tYXhTY3JvbGxYID49IDAgPyAwIDogdGhhdC5tYXhTY3JvbGxYOwoJCX0KCQlpZiAobmV3WSA+IHRoYXQubWluU2Nyb2xsWSB8fCBuZXdZIDwgdGhhdC5tYXhTY3JvbGxZKSB7IAoJCQluZXdZID0gdGhhdC5vcHRpb25zLmJvdW5jZSA/IHRoYXQueSArIChkZWx0YVkgLyAyKSA6IG5ld1kgPj0gdGhhdC5taW5TY3JvbGxZIHx8IHRoYXQubWF4U2Nyb2xsWSA+PSAwID8gdGhhdC5taW5TY3JvbGxZIDogdGhhdC5tYXhTY3JvbGxZOwoJCX0KCgkJaWYgKHRoYXQuYWJzRGlzdFggPCA2ICYmIHRoYXQuYWJzRGlzdFkgPCA2KSB7CgkJCXRoYXQuZGlzdFggKz0gZGVsdGFYOwoJCQl0aGF0LmRpc3RZICs9IGRlbHRhWTsKCQkJdGhhdC5hYnNEaXN0WCA9IG0uYWJzKHRoYXQuZGlzdFgpOwoJCQl0aGF0LmFic0Rpc3RZID0gbS5hYnModGhhdC5kaXN0WSk7CgoJCQlyZXR1cm47CgkJfQoKCQkvLyBMb2NrIGRpcmVjdGlvbgoJCWlmICh0aGF0Lm9wdGlvbnMubG9ja0RpcmVjdGlvbikgewoJCQlpZiAodGhhdC5hYnNEaXN0WCA+IHRoYXQuYWJzRGlzdFkgKyA1KSB7CgkJCQluZXdZID0gdGhhdC55OwoJCQkJZGVsdGFZID0gMDsKCQkJfSBlbHNlIGlmICh0aGF0LmFic0Rpc3RZID4gdGhhdC5hYnNEaXN0WCArIDUpIHsKCQkJCW5ld1ggPSB0aGF0Lng7CgkJCQlkZWx0YVggPSAwOwoJCQl9CgkJfQoKCQl0aGF0Lm1vdmVkID0gdHJ1ZTsKCQl0aGF0Ll9wb3MobmV3WCwgbmV3WSk7CgkJdGhhdC5kaXJYID0gZGVsdGFYID4gMCA/IC0xIDogZGVsdGFYIDwgMCA/IDEgOiAwOwoJCXRoYXQuZGlyWSA9IGRlbHRhWSA+IDAgPyAtMSA6IGRlbHRhWSA8IDAgPyAxIDogMDsKCgkJaWYgKHRpbWVzdGFtcCAtIHRoYXQuc3RhcnRUaW1lID4gMzAwKSB7CgkJCXRoYXQuc3RhcnRUaW1lID0gdGltZXN0YW1wOwoJCQl0aGF0LnN0YXJ0WCA9IHRoYXQueDsKCQkJdGhhdC5zdGFydFkgPSB0aGF0Lnk7CgkJfQoJCQoJCWlmICh0aGF0Lm9wdGlvbnMub25TY3JvbGxNb3ZlKSB0aGF0Lm9wdGlvbnMub25TY3JvbGxNb3ZlLmNhbGwodGhhdCwgZSk7Cgl9LAoJCglfZW5kOiBmdW5jdGlvbiAoZSkgewoJCWlmIChoYXNUb3VjaCAmJiBlLnRvdWNoZXMubGVuZ3RoICE9IDApIHJldHVybjsKCgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlwb2ludCA9IGhhc1RvdWNoID8gZS5jaGFuZ2VkVG91Y2hlc1swXSA6IGUsCgkJCXRhcmdldCwgZXYsCgkJCW1vbWVudHVtWCA9IHsgZGlzdDowLCB0aW1lOjAgfSwKCQkJbW9tZW50dW1ZID0geyBkaXN0OjAsIHRpbWU6MCB9LAoJCQlkdXJhdGlvbiA9IChlLnRpbWVTdGFtcCB8fCAobmV3IERhdGUoKSkuZ2V0VGltZSgpKSAtIHRoYXQuc3RhcnRUaW1lLAoJCQluZXdQb3NYID0gdGhhdC54LAoJCQluZXdQb3NZID0gdGhhdC55LAoJCQlkaXN0WCwgZGlzdFksCgkJCW5ld0R1cmF0aW9uLAoJCQlzbmFwLAoJCQlzY2FsZTsKCgkJdGhhdC5fdW5iaW5kKE1PVkVfRVYpOwoJCXRoYXQuX3VuYmluZChFTkRfRVYpOwoJCXRoYXQuX3VuYmluZChDQU5DRUxfRVYpOwoKCQlpZiAodGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsRW5kKSB0aGF0Lm9wdGlvbnMub25CZWZvcmVTY3JvbGxFbmQuY2FsbCh0aGF0LCBlKTsKCgkJaWYgKHRoYXQuem9vbWVkKSB7CgkJCXNjYWxlID0gdGhhdC5zY2FsZSAqIHRoYXQubGFzdFNjYWxlOwoJCQlzY2FsZSA9IE1hdGgubWF4KHRoYXQub3B0aW9ucy56b29tTWluLCBzY2FsZSk7CgkJCXNjYWxlID0gTWF0aC5taW4odGhhdC5vcHRpb25zLnpvb21NYXgsIHNjYWxlKTsKCQkJdGhhdC5sYXN0U2NhbGUgPSBzY2FsZSAvIHRoYXQuc2NhbGU7CgkJCXRoYXQuc2NhbGUgPSBzY2FsZTsKCgkJCXRoYXQueCA9IHRoYXQub3JpZ2luWCAtIHRoYXQub3JpZ2luWCAqIHRoYXQubGFzdFNjYWxlICsgdGhhdC54OwoJCQl0aGF0LnkgPSB0aGF0Lm9yaWdpblkgLSB0aGF0Lm9yaWdpblkgKiB0aGF0Lmxhc3RTY2FsZSArIHRoYXQueTsKCQkJCgkJCXRoYXQuc2Nyb2xsZXIuc3R5bGVbdmVuZG9yICsgJ1RyYW5zaXRpb25EdXJhdGlvbiddID0gJzIwMG1zJzsKCQkJdGhhdC5zY3JvbGxlci5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNmb3JtJ10gPSB0cm5PcGVuICsgdGhhdC54ICsgJ3B4LCcgKyB0aGF0LnkgKyAncHgnICsgdHJuQ2xvc2UgKyAnIHNjYWxlKCcgKyB0aGF0LnNjYWxlICsgJyknOwoJCQkKCQkJdGhhdC56b29tZWQgPSBmYWxzZTsKCQkJdGhhdC5yZWZyZXNoKCk7CgoJCQlpZiAodGhhdC5vcHRpb25zLm9uWm9vbUVuZCkgdGhhdC5vcHRpb25zLm9uWm9vbUVuZC5jYWxsKHRoYXQsIGUpOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIXRoYXQubW92ZWQpIHsKCQkJaWYgKGhhc1RvdWNoKSB7CgkJCQlpZiAodGhhdC5kb3VibGVUYXBUaW1lciAmJiB0aGF0Lm9wdGlvbnMuem9vbSkgewoJCQkJCS8vIERvdWJsZSB0YXBwZWQKCQkJCQljbGVhclRpbWVvdXQodGhhdC5kb3VibGVUYXBUaW1lcik7CgkJCQkJdGhhdC5kb3VibGVUYXBUaW1lciA9IG51bGw7CgkJCQkJaWYgKHRoYXQub3B0aW9ucy5vblpvb21TdGFydCkgdGhhdC5vcHRpb25zLm9uWm9vbVN0YXJ0LmNhbGwodGhhdCwgZSk7CgkJCQkJdGhhdC56b29tKHRoYXQucG9pbnRYLCB0aGF0LnBvaW50WSwgdGhhdC5zY2FsZSA9PSAxID8gdGhhdC5vcHRpb25zLmRvdWJsZVRhcFpvb20gOiAxKTsKCQkJCQlpZiAodGhhdC5vcHRpb25zLm9uWm9vbUVuZCkgewoJCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCQkJdGhhdC5vcHRpb25zLm9uWm9vbUVuZC5jYWxsKHRoYXQsIGUpOwoJCQkJCQl9LCAyMDApOyAvLyAyMDAgaXMgZGVmYXVsdCB6b29tIGR1cmF0aW9uCgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQl0aGF0LmRvdWJsZVRhcFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJCXRoYXQuZG91YmxlVGFwVGltZXIgPSBudWxsOwoKCQkJCQkJLy8gRmluZCB0aGUgbGFzdCB0b3VjaGVkIGVsZW1lbnQKCQkJCQkJdGFyZ2V0ID0gcG9pbnQudGFyZ2V0OwoJCQkJCQl3aGlsZSAodGFyZ2V0Lm5vZGVUeXBlICE9IDEpIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwoKCQkJCQkJaWYgKHRhcmdldC50YWdOYW1lICE9ICdTRUxFQ1QnICYmIHRhcmdldC50YWdOYW1lICE9ICdJTlBVVCcgJiYgdGFyZ2V0LnRhZ05hbWUgIT0gJ1RFWFRBUkVBJykgewoJCQkJCQkJZXYgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKTsKCQkJCQkJCWV2LmluaXRNb3VzZUV2ZW50KCdjbGljaycsIHRydWUsIHRydWUsIGUudmlldywgMSwKCQkJCQkJCQlwb2ludC5zY3JlZW5YLCBwb2ludC5zY3JlZW5ZLCBwb2ludC5jbGllbnRYLCBwb2ludC5jbGllbnRZLAoJCQkJCQkJCWUuY3RybEtleSwgZS5hbHRLZXksIGUuc2hpZnRLZXksIGUubWV0YUtleSwKCQkJCQkJCQkwLCBudWxsKTsKCQkJCQkJCWV2Ll9mYWtlID0gdHJ1ZTsKCQkJCQkJCXRhcmdldC5kaXNwYXRjaEV2ZW50KGV2KTsKCQkJCQkJfQoJCQkJCX0sIHRoYXQub3B0aW9ucy56b29tID8gMjUwIDogMCk7CgkJCQl9CgkJCX0KCgkJCXRoYXQuX3Jlc2V0UG9zKDIwMCk7CgoJCQlpZiAodGhhdC5vcHRpb25zLm9uVG91Y2hFbmQpIHRoYXQub3B0aW9ucy5vblRvdWNoRW5kLmNhbGwodGhhdCwgZSk7CgkJCXJldHVybjsKCQl9CgoJCWlmIChkdXJhdGlvbiA8IDMwMCAmJiB0aGF0Lm9wdGlvbnMubW9tZW50dW0pIHsKCQkJbW9tZW50dW1YID0gbmV3UG9zWCA/IHRoYXQuX21vbWVudHVtKG5ld1Bvc1ggLSB0aGF0LnN0YXJ0WCwgZHVyYXRpb24sIC10aGF0LngsIHRoYXQuc2Nyb2xsZXJXIC0gdGhhdC53cmFwcGVyVyArIHRoYXQueCwgdGhhdC5vcHRpb25zLmJvdW5jZSA/IHRoYXQud3JhcHBlclcgOiAwKSA6IG1vbWVudHVtWDsKCQkJbW9tZW50dW1ZID0gbmV3UG9zWSA/IHRoYXQuX21vbWVudHVtKG5ld1Bvc1kgLSB0aGF0LnN0YXJ0WSwgZHVyYXRpb24sIC10aGF0LnksICh0aGF0Lm1heFNjcm9sbFkgPCAwID8gdGhhdC5zY3JvbGxlckggLSB0aGF0LndyYXBwZXJIICsgdGhhdC55IC0gdGhhdC5taW5TY3JvbGxZIDogMCksIHRoYXQub3B0aW9ucy5ib3VuY2UgPyB0aGF0LndyYXBwZXJIIDogMCkgOiBtb21lbnR1bVk7CgoJCQluZXdQb3NYID0gdGhhdC54ICsgbW9tZW50dW1YLmRpc3Q7CgkJCW5ld1Bvc1kgPSB0aGF0LnkgKyBtb21lbnR1bVkuZGlzdDsKCiAJCQlpZiAoKHRoYXQueCA+IDAgJiYgbmV3UG9zWCA+IDApIHx8ICh0aGF0LnggPCB0aGF0Lm1heFNjcm9sbFggJiYgbmV3UG9zWCA8IHRoYXQubWF4U2Nyb2xsWCkpIG1vbWVudHVtWCA9IHsgZGlzdDowLCB0aW1lOjAgfTsKIAkJCWlmICgodGhhdC55ID4gdGhhdC5taW5TY3JvbGxZICYmIG5ld1Bvc1kgPiB0aGF0Lm1pblNjcm9sbFkpIHx8ICh0aGF0LnkgPCB0aGF0Lm1heFNjcm9sbFkgJiYgbmV3UG9zWSA8IHRoYXQubWF4U2Nyb2xsWSkpIG1vbWVudHVtWSA9IHsgZGlzdDowLCB0aW1lOjAgfTsKCQl9CgoJCWlmIChtb21lbnR1bVguZGlzdCB8fCBtb21lbnR1bVkuZGlzdCkgewoJCQluZXdEdXJhdGlvbiA9IG0ubWF4KG0ubWF4KG1vbWVudHVtWC50aW1lLCBtb21lbnR1bVkudGltZSksIDEwKTsKCgkJCS8vIERvIHdlIG5lZWQgdG8gc25hcD8KCQkJaWYgKHRoYXQub3B0aW9ucy5zbmFwKSB7CgkJCQlkaXN0WCA9IG5ld1Bvc1ggLSB0aGF0LmFic1N0YXJ0WDsKCQkJCWRpc3RZID0gbmV3UG9zWSAtIHRoYXQuYWJzU3RhcnRZOwoJCQkJaWYgKG0uYWJzKGRpc3RYKSA8IHRoYXQub3B0aW9ucy5zbmFwVGhyZXNob2xkICYmIG0uYWJzKGRpc3RZKSA8IHRoYXQub3B0aW9ucy5zbmFwVGhyZXNob2xkKSB7IHRoYXQuc2Nyb2xsVG8odGhhdC5hYnNTdGFydFgsIHRoYXQuYWJzU3RhcnRZLCAyMDApOyB9CgkJCQllbHNlIHsKCQkJCQlzbmFwID0gdGhhdC5fc25hcChuZXdQb3NYLCBuZXdQb3NZKTsKCQkJCQluZXdQb3NYID0gc25hcC54OwoJCQkJCW5ld1Bvc1kgPSBzbmFwLnk7CgkJCQkJbmV3RHVyYXRpb24gPSBtLm1heChzbmFwLnRpbWUsIG5ld0R1cmF0aW9uKTsKCQkJCX0KCQkJfQoKCQkJdGhhdC5zY3JvbGxUbyhtLnJvdW5kKG5ld1Bvc1gpLCBtLnJvdW5kKG5ld1Bvc1kpLCBuZXdEdXJhdGlvbik7CgoJCQlpZiAodGhhdC5vcHRpb25zLm9uVG91Y2hFbmQpIHRoYXQub3B0aW9ucy5vblRvdWNoRW5kLmNhbGwodGhhdCwgZSk7CgkJCXJldHVybjsKCQl9CgoJCS8vIERvIHdlIG5lZWQgdG8gc25hcD8KCQlpZiAodGhhdC5vcHRpb25zLnNuYXApIHsKCQkJZGlzdFggPSBuZXdQb3NYIC0gdGhhdC5hYnNTdGFydFg7CgkJCWRpc3RZID0gbmV3UG9zWSAtIHRoYXQuYWJzU3RhcnRZOwoJCQlpZiAobS5hYnMoZGlzdFgpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQgJiYgbS5hYnMoZGlzdFkpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQpIHRoYXQuc2Nyb2xsVG8odGhhdC5hYnNTdGFydFgsIHRoYXQuYWJzU3RhcnRZLCAyMDApOwoJCQllbHNlIHsKCQkJCXNuYXAgPSB0aGF0Ll9zbmFwKHRoYXQueCwgdGhhdC55KTsKCQkJCWlmIChzbmFwLnggIT0gdGhhdC54IHx8IHNuYXAueSAhPSB0aGF0LnkpIHRoYXQuc2Nyb2xsVG8oc25hcC54LCBzbmFwLnksIHNuYXAudGltZSk7CgkJCX0KCgkJCWlmICh0aGF0Lm9wdGlvbnMub25Ub3VjaEVuZCkgdGhhdC5vcHRpb25zLm9uVG91Y2hFbmQuY2FsbCh0aGF0LCBlKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhhdC5fcmVzZXRQb3MoMjAwKTsKCQlpZiAodGhhdC5vcHRpb25zLm9uVG91Y2hFbmQpIHRoYXQub3B0aW9ucy5vblRvdWNoRW5kLmNhbGwodGhhdCwgZSk7Cgl9LAoJCglfcmVzZXRQb3M6IGZ1bmN0aW9uICh0aW1lKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlyZXNldFggPSB0aGF0LnggPj0gMCA/IDAgOiB0aGF0LnggPCB0aGF0Lm1heFNjcm9sbFggPyB0aGF0Lm1heFNjcm9sbFggOiB0aGF0LngsCgkJCXJlc2V0WSA9IHRoYXQueSA+PSB0aGF0Lm1pblNjcm9sbFkgfHwgdGhhdC5tYXhTY3JvbGxZID4gMCA/IHRoYXQubWluU2Nyb2xsWSA6IHRoYXQueSA8IHRoYXQubWF4U2Nyb2xsWSA/IHRoYXQubWF4U2Nyb2xsWSA6IHRoYXQueTsKCgkJaWYgKHJlc2V0WCA9PSB0aGF0LnggJiYgcmVzZXRZID09IHRoYXQueSkgewoJCQlpZiAodGhhdC5tb3ZlZCkgewoJCQkJdGhhdC5tb3ZlZCA9IGZhbHNlOwoJCQkJaWYgKHRoYXQub3B0aW9ucy5vblNjcm9sbEVuZCkgdGhhdC5vcHRpb25zLm9uU2Nyb2xsRW5kLmNhbGwodGhhdCk7CQkvLyBFeGVjdXRlIGN1c3RvbSBjb2RlIG9uIHNjcm9sbCBlbmQKCQkJfQoKCQkJaWYgKHRoYXQuaFNjcm9sbGJhciAmJiB0aGF0Lm9wdGlvbnMuaGlkZVNjcm9sbGJhcikgewoJCQkJaWYgKHZlbmRvciA9PSAnd2Via2l0JykgdGhhdC5oU2Nyb2xsYmFyV3JhcHBlci5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNpdGlvbkRlbGF5J10gPSAnMzAwbXMnOwoJCQkJdGhhdC5oU2Nyb2xsYmFyV3JhcHBlci5zdHlsZS5vcGFjaXR5ID0gJzAnOwoJCQl9CgkJCWlmICh0aGF0LnZTY3JvbGxiYXIgJiYgdGhhdC5vcHRpb25zLmhpZGVTY3JvbGxiYXIpIHsKCQkJCWlmICh2ZW5kb3IgPT0gJ3dlYmtpdCcpIHRoYXQudlNjcm9sbGJhcldyYXBwZXIuc3R5bGVbdmVuZG9yICsgJ1RyYW5zaXRpb25EZWxheSddID0gJzMwMG1zJzsKCQkJCXRoYXQudlNjcm9sbGJhcldyYXBwZXIuc3R5bGUub3BhY2l0eSA9ICcwJzsKCQkJfQoKCQkJcmV0dXJuOwoJCX0KCgkJdGhhdC5zY3JvbGxUbyhyZXNldFgsIHJlc2V0WSwgdGltZSB8fCAwKTsKCX0sCgoJX3doZWVsOiBmdW5jdGlvbiAoZSkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJd2hlZWxEZWx0YVgsIHdoZWVsRGVsdGFZLAoJCQlkZWx0YVgsIGRlbHRhWSwKCQkJZGVsdGFTY2FsZTsKCgkJaWYgKCd3aGVlbERlbHRhWCcgaW4gZSkgewoJCQl3aGVlbERlbHRhWCA9IGUud2hlZWxEZWx0YVggLyAxMjsKCQkJd2hlZWxEZWx0YVkgPSBlLndoZWVsRGVsdGFZIC8gMTI7CgkJfSBlbHNlIGlmICgnZGV0YWlsJyBpbiBlKSB7CgkJCXdoZWVsRGVsdGFYID0gd2hlZWxEZWx0YVkgPSAtZS5kZXRhaWwgKiAzOwoJCX0gZWxzZSB7CgkJCXdoZWVsRGVsdGFYID0gd2hlZWxEZWx0YVkgPSAtZS53aGVlbERlbHRhOwoJCX0KCQkKCQlpZiAodGhhdC5vcHRpb25zLndoZWVsQWN0aW9uID09ICd6b29tJykgewoJCQlkZWx0YVNjYWxlID0gdGhhdC5zY2FsZSAqIE1hdGgucG93KDIsIDEvMyAqICh3aGVlbERlbHRhWSA/IHdoZWVsRGVsdGFZIC8gTWF0aC5hYnMod2hlZWxEZWx0YVkpIDogMCkpOwoJCQlpZiAoZGVsdGFTY2FsZSA8IHRoYXQub3B0aW9ucy56b29tTWluKSBkZWx0YVNjYWxlID0gdGhhdC5vcHRpb25zLnpvb21NaW47CgkJCWlmIChkZWx0YVNjYWxlID4gdGhhdC5vcHRpb25zLnpvb21NYXgpIGRlbHRhU2NhbGUgPSB0aGF0Lm9wdGlvbnMuem9vbU1heDsKCQkJCgkJCWlmIChkZWx0YVNjYWxlICE9IHRoYXQuc2NhbGUpIHsKCQkJCWlmICghdGhhdC53aGVlbFpvb21Db3VudCAmJiB0aGF0Lm9wdGlvbnMub25ab29tU3RhcnQpIHRoYXQub3B0aW9ucy5vblpvb21TdGFydC5jYWxsKHRoYXQsIGUpOwoJCQkJdGhhdC53aGVlbFpvb21Db3VudCsrOwoJCQkJCgkJCQl0aGF0Lnpvb20oZS5wYWdlWCwgZS5wYWdlWSwgZGVsdGFTY2FsZSwgNDAwKTsKCQkJCQoJCQkJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQl0aGF0LndoZWVsWm9vbUNvdW50LS07CgkJCQkJaWYgKCF0aGF0LndoZWVsWm9vbUNvdW50ICYmIHRoYXQub3B0aW9ucy5vblpvb21FbmQpIHRoYXQub3B0aW9ucy5vblpvb21FbmQuY2FsbCh0aGF0LCBlKTsKCQkJCX0sIDQwMCk7CgkJCX0KCQkJCgkJCXJldHVybjsKCQl9CgkJCgkJZGVsdGFYID0gdGhhdC54ICsgd2hlZWxEZWx0YVg7CgkJZGVsdGFZID0gdGhhdC55ICsgd2hlZWxEZWx0YVk7CgoJCWlmIChkZWx0YVggPiAwKSBkZWx0YVggPSAwOwoJCWVsc2UgaWYgKGRlbHRhWCA8IHRoYXQubWF4U2Nyb2xsWCkgZGVsdGFYID0gdGhhdC5tYXhTY3JvbGxYOwoKCQlpZiAoZGVsdGFZID4gdGhhdC5taW5TY3JvbGxZKSBkZWx0YVkgPSB0aGF0Lm1pblNjcm9sbFk7CgkJZWxzZSBpZiAoZGVsdGFZIDwgdGhhdC5tYXhTY3JvbGxZKSBkZWx0YVkgPSB0aGF0Lm1heFNjcm9sbFk7CgoJCXRoYXQuc2Nyb2xsVG8oZGVsdGFYLCBkZWx0YVksIDApOwoJfSwKCQoJX21vdXNlb3V0OiBmdW5jdGlvbiAoZSkgewoJCXZhciB0ID0gZS5yZWxhdGVkVGFyZ2V0OwoKCQlpZiAoIXQpIHsKCQkJdGhpcy5fZW5kKGUpOwoJCQlyZXR1cm47CgkJfQoKCQl3aGlsZSAodCA9IHQucGFyZW50Tm9kZSkgaWYgKHQgPT0gdGhpcy53cmFwcGVyKSByZXR1cm47CgkJCgkJdGhpcy5fZW5kKGUpOwoJfSwKCglfdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gKGUpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCWlmIChlLnRhcmdldCAhPSB0aGF0LnNjcm9sbGVyKSByZXR1cm47CgoJCXRoYXQuX3VuYmluZCgnd2Via2l0VHJhbnNpdGlvbkVuZCcpOwoJCQoJCXRoYXQuX3N0YXJ0QW5pKCk7Cgl9LAoKCgkvKioKCSAqCgkgKiBVdGlsaXRpZXMKCSAqCgkgKi8KCV9zdGFydEFuaTogZnVuY3Rpb24gKCkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJc3RhcnRYID0gdGhhdC54LCBzdGFydFkgPSB0aGF0LnksCgkJCXN0YXJ0VGltZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLAoJCQlzdGVwLCBlYXNlT3V0OwoKCQlpZiAodGhhdC5hbmltYXRpbmcpIHJldHVybjsKCQkKCQlpZiAoIXRoYXQuc3RlcHMubGVuZ3RoKSB7CgkJCXRoYXQuX3Jlc2V0UG9zKDQwMCk7CgkJCXJldHVybjsKCQl9CgkJCgkJc3RlcCA9IHRoYXQuc3RlcHMuc2hpZnQoKTsKCQkKCQlpZiAoc3RlcC54ID09IHN0YXJ0WCAmJiBzdGVwLnkgPT0gc3RhcnRZKSBzdGVwLnRpbWUgPSAwOwoKCQl0aGF0LmFuaW1hdGluZyA9IHRydWU7CgkJdGhhdC5tb3ZlZCA9IHRydWU7CgkJCgkJaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uKSB7CgkJCXRoYXQuX3RyYW5zaXRpb25UaW1lKHN0ZXAudGltZSk7CgkJCXRoYXQuX3BvcyhzdGVwLngsIHN0ZXAueSk7CgkJCXRoYXQuYW5pbWF0aW5nID0gZmFsc2U7CgkJCWlmIChzdGVwLnRpbWUpIHRoYXQuX2JpbmQoJ3dlYmtpdFRyYW5zaXRpb25FbmQnKTsKCQkJZWxzZSB0aGF0Ll9yZXNldFBvcygwKTsKCQkJcmV0dXJuOwoJCX0KCgkJKGZ1bmN0aW9uIGFuaW1hdGUgKCkgewoJCQl2YXIgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksCgkJCQluZXdYLCBuZXdZOwoKCQkJaWYgKG5vdyA+PSBzdGFydFRpbWUgKyBzdGVwLnRpbWUpIHsKCQkJCXRoYXQuX3BvcyhzdGVwLngsIHN0ZXAueSk7CgkJCQl0aGF0LmFuaW1hdGluZyA9IGZhbHNlOwoJCQkJaWYgKHRoYXQub3B0aW9ucy5vbkFuaW1hdGlvbkVuZCkgdGhhdC5vcHRpb25zLm9uQW5pbWF0aW9uRW5kLmNhbGwodGhhdCk7CQkJLy8gRXhlY3V0ZSBjdXN0b20gY29kZSBvbiBhbmltYXRpb24gZW5kCgkJCQl0aGF0Ll9zdGFydEFuaSgpOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlub3cgPSAobm93IC0gc3RhcnRUaW1lKSAvIHN0ZXAudGltZSAtIDE7CgkJCWVhc2VPdXQgPSBtLnNxcnQoMSAtIG5vdyAqIG5vdyk7CgkJCW5ld1ggPSAoc3RlcC54IC0gc3RhcnRYKSAqIGVhc2VPdXQgKyBzdGFydFg7CgkJCW5ld1kgPSAoc3RlcC55IC0gc3RhcnRZKSAqIGVhc2VPdXQgKyBzdGFydFk7CgkJCXRoYXQuX3BvcyhuZXdYLCBuZXdZKTsKCQkJaWYgKHRoYXQuYW5pbWF0aW5nKSB0aGF0LmFuaVRpbWUgPSBuZXh0RnJhbWUoYW5pbWF0ZSk7CgkJfSkoKTsKCX0sCgoJX3RyYW5zaXRpb25UaW1lOiBmdW5jdGlvbiAodGltZSkgewoJCXRpbWUgKz0gJ21zJzsKCQl0aGlzLnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2l0aW9uRHVyYXRpb24nXSA9IHRpbWU7CgkJaWYgKHRoaXMuaFNjcm9sbGJhcikgdGhpcy5oU2Nyb2xsYmFySW5kaWNhdG9yLnN0eWxlW3ZlbmRvciArICdUcmFuc2l0aW9uRHVyYXRpb24nXSA9IHRpbWU7CgkJaWYgKHRoaXMudlNjcm9sbGJhcikgdGhpcy52U2Nyb2xsYmFySW5kaWNhdG9yLnN0eWxlW3ZlbmRvciArICdUcmFuc2l0aW9uRHVyYXRpb24nXSA9IHRpbWU7Cgl9LAoKCV9tb21lbnR1bTogZnVuY3Rpb24gKGRpc3QsIHRpbWUsIG1heERpc3RVcHBlciwgbWF4RGlzdExvd2VyLCBzaXplKSB7CgkJdmFyIGRlY2VsZXJhdGlvbiA9IDAuMDAwNiwKCQkJc3BlZWQgPSBtLmFicyhkaXN0KSAvIHRpbWUsCgkJCW5ld0Rpc3QgPSAoc3BlZWQgKiBzcGVlZCkgLyAoMiAqIGRlY2VsZXJhdGlvbiksCgkJCW5ld1RpbWUgPSAwLCBvdXRzaWRlRGlzdCA9IDA7CgoJCS8vIFByb3BvcnRpbmFsbHkgcmVkdWNlIHNwZWVkIGlmIHdlIGFyZSBvdXRzaWRlIG9mIHRoZSBib3VuZGFyaWVzIAoJCWlmIChkaXN0ID4gMCAmJiBuZXdEaXN0ID4gbWF4RGlzdFVwcGVyKSB7CgkJCW91dHNpZGVEaXN0ID0gc2l6ZSAvICg2IC8gKG5ld0Rpc3QgLyBzcGVlZCAqIGRlY2VsZXJhdGlvbikpOwoJCQltYXhEaXN0VXBwZXIgPSBtYXhEaXN0VXBwZXIgKyBvdXRzaWRlRGlzdDsKCQkJc3BlZWQgPSBzcGVlZCAqIG1heERpc3RVcHBlciAvIG5ld0Rpc3Q7CgkJCW5ld0Rpc3QgPSBtYXhEaXN0VXBwZXI7CgkJfSBlbHNlIGlmIChkaXN0IDwgMCAmJiBuZXdEaXN0ID4gbWF4RGlzdExvd2VyKSB7CgkJCW91dHNpZGVEaXN0ID0gc2l6ZSAvICg2IC8gKG5ld0Rpc3QgLyBzcGVlZCAqIGRlY2VsZXJhdGlvbikpOwoJCQltYXhEaXN0TG93ZXIgPSBtYXhEaXN0TG93ZXIgKyBvdXRzaWRlRGlzdDsKCQkJc3BlZWQgPSBzcGVlZCAqIG1heERpc3RMb3dlciAvIG5ld0Rpc3Q7CgkJCW5ld0Rpc3QgPSBtYXhEaXN0TG93ZXI7CgkJfQoKCQluZXdEaXN0ID0gbmV3RGlzdCAqIChkaXN0IDwgMCA/IC0xIDogMSk7CgkJbmV3VGltZSA9IHNwZWVkIC8gZGVjZWxlcmF0aW9uOwoKCQlyZXR1cm4geyBkaXN0OiBuZXdEaXN0LCB0aW1lOiBtLnJvdW5kKG5ld1RpbWUpIH07Cgl9LAoKCV9vZmZzZXQ6IGZ1bmN0aW9uIChlbCkgewoJCXZhciBsZWZ0ID0gLWVsLm9mZnNldExlZnQsCgkJCXRvcCA9IC1lbC5vZmZzZXRUb3A7CgkJCQoJCXdoaWxlIChlbCA9IGVsLm9mZnNldFBhcmVudCkgewoJCQlsZWZ0IC09IGVsLm9mZnNldExlZnQ7CgkJCXRvcCAtPSBlbC5vZmZzZXRUb3A7CgkJfQoJCQoJCWlmIChlbCAhPSB0aGlzLndyYXBwZXIpIHsKCQkJbGVmdCAqPSB0aGlzLnNjYWxlOwoJCQl0b3AgKj0gdGhpcy5zY2FsZTsKCQl9CgoJCXJldHVybiB7IGxlZnQ6IGxlZnQsIHRvcDogdG9wIH07Cgl9LAoKCV9zbmFwOiBmdW5jdGlvbiAoeCwgeSkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJaSwgbCwKCQkJcGFnZSwgdGltZSwKCQkJc2l6ZVgsIHNpemVZOwoKCQkvLyBDaGVjayBwYWdlIFgKCQlwYWdlID0gdGhhdC5wYWdlc1gubGVuZ3RoIC0gMTsKCQlmb3IgKGk9MCwgbD10aGF0LnBhZ2VzWC5sZW5ndGg7IGk8bDsgaSsrKSB7CgkJCWlmICh4ID49IHRoYXQucGFnZXNYW2ldKSB7CgkJCQlwYWdlID0gaTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCWlmIChwYWdlID09IHRoYXQuY3VyclBhZ2VYICYmIHBhZ2UgPiAwICYmIHRoYXQuZGlyWCA8IDApIHBhZ2UtLTsKCQl4ID0gdGhhdC5wYWdlc1hbcGFnZV07CgkJc2l6ZVggPSBtLmFicyh4IC0gdGhhdC5wYWdlc1hbdGhhdC5jdXJyUGFnZVhdKTsKCQlzaXplWCA9IHNpemVYID8gbS5hYnModGhhdC54IC0geCkgLyBzaXplWCAqIDUwMCA6IDA7CgkJdGhhdC5jdXJyUGFnZVggPSBwYWdlOwoKCQkvLyBDaGVjayBwYWdlIFkKCQlwYWdlID0gdGhhdC5wYWdlc1kubGVuZ3RoLTE7CgkJZm9yIChpPTA7IGk8cGFnZTsgaSsrKSB7CgkJCWlmICh5ID49IHRoYXQucGFnZXNZW2ldKSB7CgkJCQlwYWdlID0gaTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCWlmIChwYWdlID09IHRoYXQuY3VyclBhZ2VZICYmIHBhZ2UgPiAwICYmIHRoYXQuZGlyWSA8IDApIHBhZ2UtLTsKCQl5ID0gdGhhdC5wYWdlc1lbcGFnZV07CgkJc2l6ZVkgPSBtLmFicyh5IC0gdGhhdC5wYWdlc1lbdGhhdC5jdXJyUGFnZVldKTsKCQlzaXplWSA9IHNpemVZID8gbS5hYnModGhhdC55IC0geSkgLyBzaXplWSAqIDUwMCA6IDA7CgkJdGhhdC5jdXJyUGFnZVkgPSBwYWdlOwoKCQkvLyBTbmFwIHdpdGggY29uc3RhbnQgc3BlZWQgKHByb3BvcnRpb25hbCBkdXJhdGlvbikKCQl0aW1lID0gbS5yb3VuZChtLm1heChzaXplWCwgc2l6ZVkpKSB8fCAyMDA7CgoJCXJldHVybiB7IHg6IHgsIHk6IHksIHRpbWU6IHRpbWUgfTsKCX0sCgoJX2JpbmQ6IGZ1bmN0aW9uICh0eXBlLCBlbCwgYnViYmxlKSB7CgkJKGVsIHx8IHRoaXMuc2Nyb2xsZXIpLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgdGhpcywgISFidWJibGUpOwoJfSwKCglfdW5iaW5kOiBmdW5jdGlvbiAodHlwZSwgZWwsIGJ1YmJsZSkgewoJCShlbCB8fCB0aGlzLnNjcm9sbGVyKS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIHRoaXMsICEhYnViYmxlKTsKCX0sCgoKCS8qKgoJICoKCSAqIFB1YmxpYyBtZXRob2RzCgkgKgoJICovCglkZXN0cm95OiBmdW5jdGlvbiAoKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQl0aGF0LnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2Zvcm0nXSA9ICcnOwoKCQkvLyBSZW1vdmUgdGhlIHNjcm9sbGJhcnMKCQl0aGF0LmhTY3JvbGxiYXIgPSBmYWxzZTsKCQl0aGF0LnZTY3JvbGxiYXIgPSBmYWxzZTsKCQl0aGF0Ll9zY3JvbGxiYXIoJ2gnKTsKCQl0aGF0Ll9zY3JvbGxiYXIoJ3YnKTsKCgkJLy8gUmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lcnMKCQl0aGF0Ll91bmJpbmQoUkVTSVpFX0VWLCB3aW5kb3cpOwoJCXRoYXQuX3VuYmluZChTVEFSVF9FVik7CgkJdGhhdC5fdW5iaW5kKE1PVkVfRVYpOwoJCXRoYXQuX3VuYmluZChFTkRfRVYpOwoJCXRoYXQuX3VuYmluZChDQU5DRUxfRVYpOwoJCQoJCWlmICh0aGF0Lm9wdGlvbnMuaGFzVG91Y2gpIHsKCQkJdGhhdC5fdW5iaW5kKCdtb3VzZW91dCcsIHRoYXQud3JhcHBlcik7CgkJCXRoYXQuX3VuYmluZChXSEVFTF9FVik7CgkJfQoJCQoJCWlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbikgdGhhdC5fdW5iaW5kKCd3ZWJraXRUcmFuc2l0aW9uRW5kJyk7CgkJCgkJaWYgKHRoYXQub3B0aW9ucy5jaGVja0RPTUNoYW5nZXMpIGNsZWFySW50ZXJ2YWwodGhhdC5jaGVja0RPTVRpbWUpOwoJCQoJCWlmICh0aGF0Lm9wdGlvbnMub25EZXN0cm95KSB0aGF0Lm9wdGlvbnMub25EZXN0cm95LmNhbGwodGhhdCk7Cgl9LAoKCXJlZnJlc2g6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCW9mZnNldCwKCQkJaSwgbCwKCQkJZWxzLAoJCQlwb3MgPSAwLAoJCQlwYWdlID0gMDsKCgkJaWYgKHRoYXQuc2NhbGUgPCB0aGF0Lm9wdGlvbnMuem9vbU1pbikgdGhhdC5zY2FsZSA9IHRoYXQub3B0aW9ucy56b29tTWluOwoJCXRoYXQud3JhcHBlclcgPSB0aGF0LndyYXBwZXIuY2xpZW50V2lkdGggfHwgMTsKCQl0aGF0LndyYXBwZXJIID0gdGhhdC53cmFwcGVyLmNsaWVudEhlaWdodCB8fCAxOwoKCQl0aGF0Lm1pblNjcm9sbFkgPSAtdGhhdC5vcHRpb25zLnRvcE9mZnNldCB8fCAwOwoJCXRoYXQuc2Nyb2xsZXJXID0gbS5yb3VuZCh0aGF0LnNjcm9sbGVyLm9mZnNldFdpZHRoICogdGhhdC5zY2FsZSk7CgkJdGhhdC5zY3JvbGxlckggPSBtLnJvdW5kKCh0aGF0LnNjcm9sbGVyLm9mZnNldEhlaWdodCArIHRoYXQubWluU2Nyb2xsWSkgKiB0aGF0LnNjYWxlKTsKCQl0aGF0Lm1heFNjcm9sbFggPSB0aGF0LndyYXBwZXJXIC0gdGhhdC5zY3JvbGxlclc7CgkJdGhhdC5tYXhTY3JvbGxZID0gdGhhdC53cmFwcGVySCAtIHRoYXQuc2Nyb2xsZXJIICsgdGhhdC5taW5TY3JvbGxZOwoJCXRoYXQuZGlyWCA9IDA7CgkJdGhhdC5kaXJZID0gMDsKCgkJaWYgKHRoYXQub3B0aW9ucy5vblJlZnJlc2gpIHRoYXQub3B0aW9ucy5vblJlZnJlc2guY2FsbCh0aGF0KTsKCgkJdGhhdC5oU2Nyb2xsID0gdGhhdC5vcHRpb25zLmhTY3JvbGwgJiYgdGhhdC5tYXhTY3JvbGxYIDwgMDsKCQl0aGF0LnZTY3JvbGwgPSB0aGF0Lm9wdGlvbnMudlNjcm9sbCAmJiAoIXRoYXQub3B0aW9ucy5ib3VuY2VMb2NrICYmICF0aGF0LmhTY3JvbGwgfHwgdGhhdC5zY3JvbGxlckggPiB0aGF0LndyYXBwZXJIKTsKCgkJdGhhdC5oU2Nyb2xsYmFyID0gdGhhdC5oU2Nyb2xsICYmIHRoYXQub3B0aW9ucy5oU2Nyb2xsYmFyOwoJCXRoYXQudlNjcm9sbGJhciA9IHRoYXQudlNjcm9sbCAmJiB0aGF0Lm9wdGlvbnMudlNjcm9sbGJhciAmJiB0aGF0LnNjcm9sbGVySCA+IHRoYXQud3JhcHBlckg7CgoJCW9mZnNldCA9IHRoYXQuX29mZnNldCh0aGF0LndyYXBwZXIpOwoJCXRoYXQud3JhcHBlck9mZnNldExlZnQgPSAtb2Zmc2V0LmxlZnQ7CgkJdGhhdC53cmFwcGVyT2Zmc2V0VG9wID0gLW9mZnNldC50b3A7CgoJCS8vIFByZXBhcmUgc25hcAoJCWlmICh0eXBlb2YgdGhhdC5vcHRpb25zLnNuYXAgPT0gJ3N0cmluZycpIHsKCQkJdGhhdC5wYWdlc1ggPSBbXTsKCQkJdGhhdC5wYWdlc1kgPSBbXTsKCQkJZWxzID0gdGhhdC5zY3JvbGxlci5xdWVyeVNlbGVjdG9yQWxsKHRoYXQub3B0aW9ucy5zbmFwKTsKCQkJZm9yIChpPTAsIGw9ZWxzLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJCXBvcyA9IHRoYXQuX29mZnNldChlbHNbaV0pOwoJCQkJcG9zLmxlZnQgKz0gdGhhdC53cmFwcGVyT2Zmc2V0TGVmdDsKCQkJCXBvcy50b3AgKz0gdGhhdC53cmFwcGVyT2Zmc2V0VG9wOwoJCQkJdGhhdC5wYWdlc1hbaV0gPSBwb3MubGVmdCA8IHRoYXQubWF4U2Nyb2xsWCA/IHRoYXQubWF4U2Nyb2xsWCA6IHBvcy5sZWZ0ICogdGhhdC5zY2FsZTsKCQkJCXRoYXQucGFnZXNZW2ldID0gcG9zLnRvcCA8IHRoYXQubWF4U2Nyb2xsWSA/IHRoYXQubWF4U2Nyb2xsWSA6IHBvcy50b3AgKiB0aGF0LnNjYWxlOwoJCQl9CgkJfSBlbHNlIGlmICh0aGF0Lm9wdGlvbnMuc25hcCkgewoJCQl0aGF0LnBhZ2VzWCA9IFtdOwoJCQl3aGlsZSAocG9zID49IHRoYXQubWF4U2Nyb2xsWCkgewoJCQkJdGhhdC5wYWdlc1hbcGFnZV0gPSBwb3M7CgkJCQlwb3MgPSBwb3MgLSB0aGF0LndyYXBwZXJXOwoJCQkJcGFnZSsrOwoJCQl9CgkJCWlmICh0aGF0Lm1heFNjcm9sbFgldGhhdC53cmFwcGVyVykgdGhhdC5wYWdlc1hbdGhhdC5wYWdlc1gubGVuZ3RoXSA9IHRoYXQubWF4U2Nyb2xsWCAtIHRoYXQucGFnZXNYW3RoYXQucGFnZXNYLmxlbmd0aC0xXSArIHRoYXQucGFnZXNYW3RoYXQucGFnZXNYLmxlbmd0aC0xXTsKCgkJCXBvcyA9IDA7CgkJCXBhZ2UgPSAwOwoJCQl0aGF0LnBhZ2VzWSA9IFtdOwoJCQl3aGlsZSAocG9zID49IHRoYXQubWF4U2Nyb2xsWSkgewoJCQkJdGhhdC5wYWdlc1lbcGFnZV0gPSBwb3M7CgkJCQlwb3MgPSBwb3MgLSB0aGF0LndyYXBwZXJIOwoJCQkJcGFnZSsrOwoJCQl9CgkJCWlmICh0aGF0Lm1heFNjcm9sbFkldGhhdC53cmFwcGVySCkgdGhhdC5wYWdlc1lbdGhhdC5wYWdlc1kubGVuZ3RoXSA9IHRoYXQubWF4U2Nyb2xsWSAtIHRoYXQucGFnZXNZW3RoYXQucGFnZXNZLmxlbmd0aC0xXSArIHRoYXQucGFnZXNZW3RoYXQucGFnZXNZLmxlbmd0aC0xXTsKCQl9CgoJCS8vIFByZXBhcmUgdGhlIHNjcm9sbGJhcnMKCQl0aGF0Ll9zY3JvbGxiYXIoJ2gnKTsKCQl0aGF0Ll9zY3JvbGxiYXIoJ3YnKTsKCgkJaWYgKCF0aGF0Lnpvb21lZCkgewoJCQl0aGF0LnNjcm9sbGVyLnN0eWxlW3ZlbmRvciArICdUcmFuc2l0aW9uRHVyYXRpb24nXSA9ICcwJzsKCQkJdGhhdC5fcmVzZXRQb3MoMjAwKTsKCQl9Cgl9LAoKCXNjcm9sbFRvOiBmdW5jdGlvbiAoeCwgeSwgdGltZSwgcmVsYXRpdmUpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXN0ZXAgPSB4LAoJCQlpLCBsOwoKCQl0aGF0LnN0b3AoKTsKCgkJaWYgKCFzdGVwLmxlbmd0aCkgc3RlcCA9IFt7IHg6IHgsIHk6IHksIHRpbWU6IHRpbWUsIHJlbGF0aXZlOiByZWxhdGl2ZSB9XTsKCQkKCQlmb3IgKGk9MCwgbD1zdGVwLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJaWYgKHN0ZXBbaV0ucmVsYXRpdmUpIHsgc3RlcFtpXS54ID0gdGhhdC54IC0gc3RlcFtpXS54OyBzdGVwW2ldLnkgPSB0aGF0LnkgLSBzdGVwW2ldLnk7IH0KCQkJdGhhdC5zdGVwcy5wdXNoKHsgeDogc3RlcFtpXS54LCB5OiBzdGVwW2ldLnksIHRpbWU6IHN0ZXBbaV0udGltZSB8fCAwIH0pOwoJCX0KCgkJdGhhdC5fc3RhcnRBbmkoKTsKCX0sCgoJc2Nyb2xsVG9FbGVtZW50OiBmdW5jdGlvbiAoZWwsIHRpbWUpIHsKCQl2YXIgdGhhdCA9IHRoaXMsIHBvczsKCQllbCA9IGVsLm5vZGVUeXBlID8gZWwgOiB0aGF0LnNjcm9sbGVyLnF1ZXJ5U2VsZWN0b3IoZWwpOwoJCWlmICghZWwpIHJldHVybjsKCgkJcG9zID0gdGhhdC5fb2Zmc2V0KGVsKTsKCQlwb3MubGVmdCArPSB0aGF0LndyYXBwZXJPZmZzZXRMZWZ0OwoJCXBvcy50b3AgKz0gdGhhdC53cmFwcGVyT2Zmc2V0VG9wOwoKCQlwb3MubGVmdCA9IHBvcy5sZWZ0ID4gMCA/IDAgOiBwb3MubGVmdCA8IHRoYXQubWF4U2Nyb2xsWCA/IHRoYXQubWF4U2Nyb2xsWCA6IHBvcy5sZWZ0OwoJCXBvcy50b3AgPSBwb3MudG9wID4gdGhhdC5taW5TY3JvbGxZID8gdGhhdC5taW5TY3JvbGxZIDogcG9zLnRvcCA8IHRoYXQubWF4U2Nyb2xsWSA/IHRoYXQubWF4U2Nyb2xsWSA6IHBvcy50b3A7CgkJdGltZSA9IHRpbWUgPT09IHVuZGVmaW5lZCA/IG0ubWF4KG0uYWJzKHBvcy5sZWZ0KSoyLCBtLmFicyhwb3MudG9wKSoyKSA6IHRpbWU7CgoJCXRoYXQuc2Nyb2xsVG8ocG9zLmxlZnQsIHBvcy50b3AsIHRpbWUpOwoJfSwKCglzY3JvbGxUb1BhZ2U6IGZ1bmN0aW9uIChwYWdlWCwgcGFnZVksIHRpbWUpIHsKCQl2YXIgdGhhdCA9IHRoaXMsIHgsIHk7CgkJCgkJaWYgKHRoYXQub3B0aW9ucy5zbmFwKSB7CgkJCXBhZ2VYID0gcGFnZVggPT0gJ25leHQnID8gdGhhdC5jdXJyUGFnZVgrMSA6IHBhZ2VYID09ICdwcmV2JyA/IHRoYXQuY3VyclBhZ2VYLTEgOiBwYWdlWDsKCQkJcGFnZVkgPSBwYWdlWSA9PSAnbmV4dCcgPyB0aGF0LmN1cnJQYWdlWSsxIDogcGFnZVkgPT0gJ3ByZXYnID8gdGhhdC5jdXJyUGFnZVktMSA6IHBhZ2VZOwoKCQkJcGFnZVggPSBwYWdlWCA8IDAgPyAwIDogcGFnZVggPiB0aGF0LnBhZ2VzWC5sZW5ndGgtMSA/IHRoYXQucGFnZXNYLmxlbmd0aC0xIDogcGFnZVg7CgkJCXBhZ2VZID0gcGFnZVkgPCAwID8gMCA6IHBhZ2VZID4gdGhhdC5wYWdlc1kubGVuZ3RoLTEgPyB0aGF0LnBhZ2VzWS5sZW5ndGgtMSA6IHBhZ2VZOwoKCQkJdGhhdC5jdXJyUGFnZVggPSBwYWdlWDsKCQkJdGhhdC5jdXJyUGFnZVkgPSBwYWdlWTsKCQkJeCA9IHRoYXQucGFnZXNYW3BhZ2VYXTsKCQkJeSA9IHRoYXQucGFnZXNZW3BhZ2VZXTsKCQl9IGVsc2UgewoJCQl4ID0gLXRoYXQud3JhcHBlclcgKiBwYWdlWDsKCQkJeSA9IC10aGF0LndyYXBwZXJIICogcGFnZVk7CgkJCWlmICh4IDwgdGhhdC5tYXhTY3JvbGxYKSB4ID0gdGhhdC5tYXhTY3JvbGxYOwoJCQlpZiAoeSA8IHRoYXQubWF4U2Nyb2xsWSkgeSA9IHRoYXQubWF4U2Nyb2xsWTsKCQl9CgoJCXRoYXQuc2Nyb2xsVG8oeCwgeSwgdGltZSB8fCA0MDApOwoJfSwKCglkaXNhYmxlOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5zdG9wKCk7CgkJdGhpcy5fcmVzZXRQb3MoMCk7CgkJdGhpcy5lbmFibGVkID0gZmFsc2U7CgoJCS8vIElmIGRpc2FibGVkIGFmdGVyIHRvdWNoc3RhcnQgd2UgbWFrZSBzdXJlIHRoYXQgdGhlcmUgYXJlIG5vIGxlZnQgb3ZlciBldmVudHMKCQl0aGlzLl91bmJpbmQoTU9WRV9FVik7CgkJdGhpcy5fdW5iaW5kKEVORF9FVik7CgkJdGhpcy5fdW5iaW5kKENBTkNFTF9FVik7Cgl9LAoJCgllbmFibGU6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmVuYWJsZWQgPSB0cnVlOwoJfSwKCQoJc3RvcDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLm9wdGlvbnMudXNlVHJhbnNpdGlvbikgdGhpcy5fdW5iaW5kKCd3ZWJraXRUcmFuc2l0aW9uRW5kJyk7CgkJZWxzZSBjYW5jZWxGcmFtZSh0aGlzLmFuaVRpbWUpOwoJCXRoaXMuc3RlcHMgPSBbXTsKCQl0aGlzLm1vdmVkID0gZmFsc2U7CgkJdGhpcy5hbmltYXRpbmcgPSBmYWxzZTsKCX0sCgkKCXpvb206IGZ1bmN0aW9uICh4LCB5LCBzY2FsZSwgdGltZSkgewoJCXZhciB0aGF0ID0gdGhpcywKCQkJcmVsU2NhbGUgPSBzY2FsZSAvIHRoYXQuc2NhbGU7CgoJCWlmICghdGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSkgcmV0dXJuOwoKCQl0aGF0Lnpvb21lZCA9IHRydWU7CgkJdGltZSA9IHRpbWUgPT09IHVuZGVmaW5lZCA/IDIwMCA6IHRpbWU7CgkJeCA9IHggLSB0aGF0LndyYXBwZXJPZmZzZXRMZWZ0IC0gdGhhdC54OwoJCXkgPSB5IC0gdGhhdC53cmFwcGVyT2Zmc2V0VG9wIC0gdGhhdC55OwoJCXRoYXQueCA9IHggLSB4ICogcmVsU2NhbGUgKyB0aGF0Lng7CgkJdGhhdC55ID0geSAtIHkgKiByZWxTY2FsZSArIHRoYXQueTsKCgkJdGhhdC5zY2FsZSA9IHNjYWxlOwoJCXRoYXQucmVmcmVzaCgpOwoKCQl0aGF0LnggPSB0aGF0LnggPiAwID8gMCA6IHRoYXQueCA8IHRoYXQubWF4U2Nyb2xsWCA/IHRoYXQubWF4U2Nyb2xsWCA6IHRoYXQueDsKCQl0aGF0LnkgPSB0aGF0LnkgPiB0aGF0Lm1pblNjcm9sbFkgPyB0aGF0Lm1pblNjcm9sbFkgOiB0aGF0LnkgPCB0aGF0Lm1heFNjcm9sbFkgPyB0aGF0Lm1heFNjcm9sbFkgOiB0aGF0Lnk7CgoJCXRoYXQuc2Nyb2xsZXIuc3R5bGVbdmVuZG9yICsgJ1RyYW5zaXRpb25EdXJhdGlvbiddID0gdGltZSArICdtcyc7CgkJdGhhdC5zY3JvbGxlci5zdHlsZVt2ZW5kb3IgKyAnVHJhbnNmb3JtJ10gPSB0cm5PcGVuICsgdGhhdC54ICsgJ3B4LCcgKyB0aGF0LnkgKyAncHgnICsgdHJuQ2xvc2UgKyAnIHNjYWxlKCcgKyBzY2FsZSArICcpJzsKCQl0aGF0Lnpvb21lZCA9IGZhbHNlOwoJfSwKCQoJaXNSZWFkeTogZnVuY3Rpb24gKCkgewoJCXJldHVybiAhdGhpcy5tb3ZlZCAmJiAhdGhpcy56b29tZWQgJiYgIXRoaXMuYW5pbWF0aW5nOwoJfQp9OwoKaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgZXhwb3J0cy5pU2Nyb2xsID0gaVNjcm9sbDsKZWxzZSB3aW5kb3cuaVNjcm9sbCA9IGlTY3JvbGw7Cgp9KSgpOwo=">
    </script>
    <script type="text/javascript">
      var queue = new Array();
      var scroll = null;
      function dequeue() {
        if (queue.length > 0) {
          var item = queue.shift();
          return item;
        } else {
          return undefined;
        }
      }
      hide = function() {
        queue.push("memoryleak://localhost/hide");
      };
      fullscreen = function() {
        queue.push("memoryleak://localhost/fullscreen");
      };
      show = function () {
        queue.push("memoryleak://localhost/show");
      };
      offline = function() {
        setTimeout(function () {
          scroll = new iScroll('wrapper', {
            snap: 'li',
            momentum: false,
            hScrollbar: false
          });
        }, 10);
      };
      loaded = function() {
        setTimeout(function () {
          actions = document.body.getElementsByTagName("form");
          for (i=0; i<actions.length; i++) {
            actions[i].onclick = function(event) {
              queue.push(this.action);
            };
          }
          show();
        }, 10);
      };
      window.onload = loaded;
      document.addEventListener('DOMContentLoaded', offline, false);
    </script>
    <style>
      * { outline: none; -webkit-tap-highlight-color: rgba(255, 255, 255, 0); }
      body { background-color: transparent; margin: 0em; padding: 0em; -webkit-user-select:none; -webkit-text-size-adjust:none; }
      form[action="memoryleak://localhost/start?0"] { float: left; width:100%; height:100%; background: left no-repeat url(http://th871.photobucket.com/albums/ab277/ANNNNNNNNA_bucket/Animated%20Gif/Psychedelic%20Animated%20Gifs/th_trippyA.gif);}
      form[action="memoryleak://localhost/start?1"] { float: left; width:100%; height:100%; background: left no-repeat url(http://th871.photobucket.com/albums/ab277/ANNNNNNNNA_bucket/Animated%20Gif/Psychedelic%20Animated%20Gifs/th_thSyko_Luigi_by_Apkinesis-1.gif);}
      form[action="memoryleak://localhost/start?2"] { float: left; width:100%; height:100%; background: left no-repeat url(http://i304.photobucket.com/albums/nn184/jkotas1/SonicTheHedgehog.gif);}
      form[action="memoryleak://localhost/start?3"] { float: left; width:100%; height:100%; background: left no-repeat url(http://th871.photobucket.com/albums/ab277/ANNNNNNNNA_bucket/Animated%20Gif/Psychedelic%20Animated%20Gifs/th_703459-i727_photobucket_com-albums-.gif);}
      form[id="youtube-form"] { float: left; width:160px; height:120px; background:#c90efb; border:0em solid #333789; }
      form[id="vimeo-form"] { float: left; width:160px; height:120px; background:#c90efb; border:0em solid #333789; }
      ul,li,form,iframe { padding: 0; margin: 0; }
      #wrapper { width: 100%; height: 120px; float:left; position:relative; overflow:hidden; }
      #scroller { width: 1000px;  height: 120px; float:left; padding:0; }
      #scroller ul { list-style: none; display: block; float:left; width: 100%; height: 120px; }
      #scroller li { -webkit-box-sizing:border-box; -moz-box-sizing:border-box; -o-box-sizing:border-box; box-sizing:border-box; display: block; float: left; width: 160px; height: 120px; }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="scroller">
        <ul>
        <!--
          <li>
            <form id="youtube-form">
              <iframe class="youtube-player" type="text/html" width="160" height="120" src="http://www.youtube.com/embed/QH2-TGUlwu4?controls=0&showinfo=0" frameborder="0">
              </iframe>
            </form>
          </li>
        -->
          <li>
            <form id="vimeo-form">
              <iframe src="http://player.vimeo.com/video/1293490?title=0&amp;byline=0&amp;portrait=0" width="160" height="120" frameborder="0">
              </iframe>
            </form>
          </li>
          <li>
            <form action="memoryleak://localhost/start?0">
              0
            </form>
          </li>
          <li>
            <form action="memoryleak://localhost/start?1">
              1
            </form>
          </li>
          <li>
            <form action="memoryleak://localhost/start?2">
              2
            </form>
          </li>
          <li>
            <form action="memoryleak://localhost/start?3">
              3
            </form>
          </li>
        </ul>
      </div>
    </div>
  </body>
</html>
